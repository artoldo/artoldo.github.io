<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="robots" content="noindex, nofollow" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Dead As A Dodo</title>
<link rel="icon" href="./icon.jpeg" type="image" />
<style>
  html, body { margin:0; padding:0; height:100%; background:#000; font-family:Arial,sans-serif; overflow:hidden; -webkit-user-select:none; touch-action:manipulation; }
  #backgroundVideoContainer { position:fixed; inset:0; z-index:-1; overflow:hidden; background:#000; }
  iframe.backgroundVideo { width:100%; height:100%; object-fit:cover; border:0; display:block; }

  #overlayImage {
    position:fixed;
    top:0;
    left:0;
    width:100vw;
    height:100vh;
    object-fit:cover;
    z-index:1000;
    pointer-events:none; /* overlay should not capture pointer events */
    display:none;
  }

  #playerAudio, #playerVideo {
    position: absolute;
    width: 0;
    height: 0;
    overflow: hidden;
  }

  .center-wrap { 
    position:fixed; 
    inset:0; 
    display:flex; 
    align-items:center; 
    justify-content:center; 
    z-index:20; /* above iframe and overlay */
    pointer-events:none; /* make container not capture pointer events except its children */
  }

  .btn-container {
    display:flex;
    flex-direction:column;
    gap:1rem;
    align-items:center;
    pointer-events:auto; /* allow clicks on buttons */
  }

  .btn {
    padding:1.0rem 1.6rem; 
    font-size:1.05rem; 
    border-radius:999px; 
    border:none; 
    background:rgba(255,255,255,0.08); 
    color:#fff; 
    cursor:pointer;
    -webkit-tap-highlight-color: transparent;
    box-shadow: 0 6px 18px rgba(0,0,0,0.4);
  }

  /* Floating pause button option (uncomment use if desired)
  .pause-floating {
    position:fixed;
    bottom:24px;
    left:50%;
    transform:translateX(-50%);
    z-index:30;
  }
  */

  /* disable pointer events for the visible iframe so clicks pass through */
  .no-pointer {
    pointer-events: none;
  }

  /* small responsive tweaks */
  @media (max-width:600px) {
    .btn { padding:0.9rem 1.2rem; font-size:1rem; }
  }
</style>
</head>
<body>

<div id="backgroundVideoContainer">
  <img id="overlayImage" src="overlay.png?text=Overlay+Image" alt="Overlay Image">
</div>

<!-- Buttons -->
<div class="center-wrap">
  <div class="btn-container" role="group" aria-label="Controls">
    <button id="startBtn" class="btn" aria-pressed="false">Start</button>
    <button id="pauseBtn" class="btn" style="display:none;" aria-pressed="false">Pause</button>
  </div>
</div>

<!-- Hidden players for audio/video control via IFrame API (kept invisible) -->
<div id="playerAudio"></div>
<div id="playerVideo"></div>

<!-- YouTube IFrame API -->
<script src="https://www.youtube.com/iframe_api"></script>
<script>
/*
  Notes about mobile fullscreen:
  - Fullscreen must be requested from a user gesture. We call requestFullscreen() inside the Start button handler.
  - We add allow="autoplay; fullscreen" and include playsinline=0 in the embed src so mobile browsers are more likely to open fullscreen.
  - Some mobile browsers / OS versions may still behave differently; this uses best-practice settings.
*/

let audioPlayer, videoPlayer;

const startBtn = document.getElementById('startBtn');
const pauseBtn = document.getElementById('pauseBtn');
const videoContainer = document.getElementById('backgroundVideoContainer');
const overlay = document.getElementById('overlayImage');

// Replace these with your own playlists
const audioPlaylist = "PLpl0gbjp6SNgVTChwLquy2UeXV65Nn4Rw";
const videoPlaylist = "PL_LVhuUg2LojR3__x7z46re98NMzGHXCU";

const randomMusic = true;
const randomVideo = true;

/* YouTube IFrame API ready callback */
function onYouTubeIframeAPIReady() {
  audioPlayer = new YT.Player('playerAudio', {
    height: '1',
    width: '1',
    playerVars: { listType: 'playlist', list: audioPlaylist, controls: 0, rel: 0 },
    events: {
      onReady: (e) => { try { e.target.setVolume(100); } catch(e){} },
      onStateChange: onAudioStateChange
    }
  });

  // Hidden controller for playlist playback (keeps API control functions available)
  videoPlayer = new YT.Player('playerVideo', {
    height: '1',
    width: '1',
    playerVars: { listType: 'playlist', list: videoPlaylist, autoplay: 0, mute: 1, controls: 0, loop: 1, playlist: videoPlaylist },
  });
}

/* Play another random audio track when playlist ends */
function onAudioStateChange(event) {
  if (event.data === YT.PlayerState.ENDED && randomMusic) {
    const pl = audioPlayer.getPlaylist();
    if (pl && pl.length) audioPlayer.playVideoAt(Math.floor(Math.random() * pl.length));
  }
}

/* Embed the visible background iframe; add attributes to help mobile fullscreen */
function embedBackgroundVideo(playlistId){
  // Adjust the "10" value to your playlist length (or compute dynamically if needed)
  const randomIndex = Math.floor(Math.random() * 10);
  const src = `https://www.youtube.com/embed?listType=playlist&list=${playlistId}&autoplay=1&mute=1&controls=0&loop=1&index=${randomIndex}&playlist=${playlistId}&playsinline=0`;
  const iframeHTML = `<iframe class="backgroundVideo no-pointer" src="${src}" frameborder="0" allow="autoplay; fullscreen; encrypted-media" allowfullscreen></iframe>`;

  // Inject iframe and keep overlay on top
  videoContainer.innerHTML = iframeHTML;
  videoContainer.appendChild(overlay);
}

/* Toggle overlay visibility based on fullscreen state */
function toggleOverlay() {
  const fsElement = document.fullscreenElement || document.webkitFullscreenElement || document.mozFullScreenElement || document.msFullscreenElement;
  overlay.style.display = fsElement ? 'block' : 'none';
}

document.addEventListener('fullscreenchange', toggleOverlay);
document.addEventListener('webkitfullscreenchange', toggleOverlay);
document.addEventListener('mozfullscreenchange', toggleOverlay);
document.addEventListener('msfullscreenchange', toggleOverlay);

/* Start button handler - user gesture required for autoplay/fullscreen on mobile */
startBtn.addEventListener('click', () => {
  if (!audioPlayer || !videoPlayer) return;

  // Play audio via hidden API player
  try {
    const audioPl = audioPlayer.getPlaylist();
    if (randomMusic && audioPl && audioPl.length) audioPlayer.playVideoAt(Math.floor(Math.random() * audioPl.length));
    else audioPlayer.playVideo();
  } catch (e) {
    // ignore if player not ready yet
  }

  // Play hidden video (keeps API playlist in sync)
  try {
    const videoPl = videoPlayer.getPlaylist();
    if (randomVideo && videoPl && videoPl.length) videoPlayer.playVideoAt(Math.floor(Math.random() * videoPl.length));
    else videoPlayer.playVideo();
  } catch (e) {
    // ignore if player not ready yet
  }

  // Embed visible iframe (with autoplay & playsinline param)
  embedBackgroundVideo(videoPlaylist);

  // Request fullscreen from the video container (must be in the same user gesture)
  const el = videoContainer;
  if (el.requestFullscreen) {
    el.requestFullscreen().catch(()=>{/* some mobile browsers may reject */});
  } else if (el.webkitRequestFullscreen) {
    // older WebKit
    try { el.webkitRequestFullscreen(); } catch(e){}
  } else if (el.msRequestFullscreen) {
    try { el.msRequestFullscreen(); } catch(e){}
  }

  startBtn.style.display = 'none';
  pauseBtn.style.display = 'block';
  startBtn.setAttribute('aria-pressed', 'true');
});

/* Pause button handler */
pauseBtn.addEventListener('click', () => {
  try { if (audioPlayer) audioPlayer.pauseVideo(); } catch(e){}
  try { if (videoPlayer) videoPlayer.pauseVideo(); } catch(e){}

  // Also attempt to pause the visible iframe by replacing it with the same src but without autoplay,
  // or leave it paused: because iframe is no-pointer we can't call its contentWindow safely for cross-origin.
  // We rely on the hidden API player to control playback and the visible iframe will reflect the stream state.

  startBtn.style.display = 'block';
  pauseBtn.style.display = 'none';
  startBtn.setAttribute('aria-pressed', 'false');
});

/* Ensure overlay doesn't capture clicks */
overlay.style.pointerEvents = 'none';

/* Optional: if you want Pause to be a floating button on phones uncomment and adjust CSS above. */
</script>

</body>
</html>