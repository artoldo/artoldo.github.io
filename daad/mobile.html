<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="robots" content="noindex, nofollow">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dead As A Dodo</title>
<link rel="icon" href="./icon.jpeg" type="image">
<style>
  html, body { margin:0; padding:0; height:100%; background:#000; font-family:Arial,sans-serif; overflow:hidden; }
  #backgroundVideoContainer { position:fixed; inset:0; z-index:-1; overflow:hidden; }
  iframe.backgroundVideo { width:100%; height:100%; object-fit:cover; }

  #overlayImage {
    position:fixed;
    top:0;
    left:0;
    width:100vw;
    height:100vh;
    object-fit:cover;
    z-index:1000;
    pointer-events:none;
    display:none;
  }

  #playerAudio, #playerVideo {
    position: absolute;
    width: 0;
    height: 0;
    overflow: hidden;
  }

  .center-wrap { 
    position:fixed; 
    inset:0; 
    display:flex; 
    align-items:center; 
    justify-content:center; 
    z-index:10; 
  }

  .btn {
    padding:1.2rem 2rem; 
    font-size:1.3rem; 
    border-radius:999px; 
    border:none; 
    background:rgba(255,255,255,0.08); 
    color:#fff; 
    cursor:pointer;
  }

  .btn-container {
    display:flex;
    flex-direction:column;
    gap:1rem;
    align-items:center;
  }

  .no-pointer {
    pointer-events: none;
  }

  /* Pseudo fullscreen fallback (for mobile browsers that block iframe fullscreen) */
  .pseudo-fullscreen {
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    width: 100vw !important;
    height: 100vh !important;
    z-index: 900 !important; /* below overlay (1000) */
  }

  @media (max-width:600px){
    .btn { padding:1rem 1.6rem; font-size:1rem; }
  }
</style>
</head>
<body>

<div id="backgroundVideoContainer">
  <img id="overlayImage" src="overlay.png?text=Overlay+Image" alt="Overlay Image">
</div>

<div class="center-wrap">
  <div class="btn-container">
    <button id="startBtn" class="btn">Start</button>
    <button id="pauseBtn" class="btn" style="display:none;">Pause</button>
  </div>
</div>

<div id="playerAudio"></div>
<div id="playerVideo"></div>

<script src="https://www.youtube.com/iframe_api"></script>
<script>
let audioPlayer, videoPlayer;

const startBtn = document.getElementById('startBtn');
const pauseBtn = document.getElementById('pauseBtn');
const videoContainer = document.getElementById('backgroundVideoContainer');
const overlay = document.getElementById('overlayImage');

// Hardcoded playlists
const audioPlaylist = "PLpl0gbjp6SNgVTChwLquy2UeXV65Nn4Rw";
const videoPlaylist = "PL_LVhuUg2LojR3__x7z46re98NMzGHXCU";

const randomMusic = true;
const randomVideo = true;

function onYouTubeIframeAPIReady() {
  audioPlayer = new YT.Player('playerAudio', {
    height:'1', width:'1',
    playerVars:{ listType:'playlist', list:audioPlaylist, controls:0, rel:0 },
    events:{ 
      onReady: (e)=>{ try { e.target.setVolume(100); } catch(e){} }, 
      onStateChange: onAudioStateChange 
    }
  });

  videoPlayer = new YT.Player('playerVideo', {
    height:'1', width:'1',
    playerVars:{ listType:'playlist', list:videoPlaylist, autoplay:0, mute:1, controls:0, loop:1, playlist:videoPlaylist },
  });
}

function onAudioStateChange(event){
  if(event.data === YT.PlayerState.ENDED && randomMusic){
    const pl = audioPlayer.getPlaylist();
    if(pl && pl.length) audioPlayer.playVideoAt(Math.floor(Math.random()*pl.length));
  }
}

/* --- NEW: create iframe element instead of innerHTML so overlay never gets removed --- */
function createVisibleIframe(playlistId){
  const randomIndex = Math.floor(Math.random() * 10); // adjust to playlist length if known
  const src = `https://www.youtube.com/embed?listType=playlist&list=${encodeURIComponent(playlistId)}&autoplay=1&mute=1&controls=0&loop=1&index=${randomIndex}&playlist=${encodeURIComponent(playlistId)}&playsinline=0`;
  const iframe = document.createElement('iframe');
  iframe.className = 'backgroundVideo no-pointer';
  iframe.src = src;
  iframe.setAttribute('frameborder', '0');
  iframe.setAttribute('allow', 'autoplay; fullscreen; encrypted-media');
  iframe.setAttribute('allowfullscreen', '');
  iframe.style.width = '100%';
  iframe.style.height = '100%';
  return iframe;
}

/* --- NEW: try iframe fullscreen first, then container, then fallback pseudo-fullscreen --- */
async function enterFullscreenPreferIframe(iframe){
  if(!iframe) return false;

  // Try iframe.requestFullscreen()
  try {
    if (iframe.requestFullscreen) {
      await iframe.requestFullscreen();
      return true;
    } else if (iframe.webkitRequestFullscreen) {
      iframe.webkitRequestFullscreen();
      return true;
    } else if (iframe.msRequestFullscreen) {
      iframe.msRequestFullscreen();
      return true;
    }
  } catch(err){
    // may be rejected on some mobile browsers
  }

  // Try container.requestFullscreen()
  try {
    if (videoContainer.requestFullscreen) {
      await videoContainer.requestFullscreen();
      return true;
    } else if (videoContainer.webkitRequestFullscreen) {
      videoContainer.webkitRequestFullscreen();
      return true;
    } else if (videoContainer.msRequestFullscreen) {
      videoContainer.msRequestFullscreen();
      return true;
    }
  } catch(err){}

  // Fallback: pseudo-fullscreen
  try {
    iframe.classList.add('pseudo-fullscreen');
    videoContainer.classList.add('pseudo-fullscreen');
  } catch(e){}
  return false;
}

/* --- Show overlay when native fullscreen or pseudo-fullscreen active --- */
function toggleOverlay() {
  const fsElement = document.fullscreenElement || document.webkitFullscreenElement || document.mozFullScreenElement || document.msFullscreenElement;
  const pseudoActive = !!document.querySelector('.backgroundVideo.pseudo-fullscreen');
  overlay.style.display = (fsElement || pseudoActive) ? 'block' : 'none';
}

document.addEventListener('fullscreenchange', toggleOverlay);
document.addEventListener('webkitfullscreenchange', toggleOverlay);
document.addEventListener('mozfullscreenchange', toggleOverlay);
document.addEventListener('msfullscreenchange', toggleOverlay);

/* --- Start button click: preserved functionality, but use createVisibleIframe and robust fullscreen --- */
startBtn.addEventListener('click', async ()=>{
  if(!audioPlayer || !videoPlayer) return;

  // Audio
  try {
    const audioPl = audioPlayer.getPlaylist();
    if(randomMusic && audioPl && audioPl.length) audioPlayer.playVideoAt(Math.floor(Math.random()*audioPl.length));
    else audioPlayer.playVideo();
  } catch(e){}

  // Video (hidden controller)
  try {
    const videoPl = videoPlayer.getPlaylist();
    if(randomVideo && videoPl && videoPl.length) videoPlayer.playVideoAt(Math.floor(Math.random()*videoPl.length));
    else videoPlayer.playVideo();
  } catch(e){}

  // Remove previous iframe if any but DO NOT remove the overlay img node
  const prevIframe = videoContainer.querySelector('iframe.backgroundVideo');
  if(prevIframe) {
    try { videoContainer.removeChild(prevIframe); } catch(e){}
  }

  // Create and append iframe, then ensure overlay is appended after iframe so it's on top
  const iframe = createVisibleIframe(videoPlaylist);
  videoContainer.appendChild(iframe);
  // Re-append overlay to ensure stacking order (this does not recreate or remove it)
  if (overlay.parentElement !== videoContainer) videoContainer.appendChild(overlay);
  else videoContainer.appendChild(overlay);

  // Try fullscreen (iframe preferred), fallback to container or pseudo
  await enterFullscreenPreferIframe(iframe);
  toggleOverlay();

  startBtn.style.display = 'none';
  pauseBtn.style.display = 'block';
});

/* --- Pause handler: preserved functionality --- */
pauseBtn.addEventListener('click', ()=>{
  try { audioPlayer.pauseVideo(); } catch(e){}
  try { videoPlayer.pauseVideo(); } catch(e){}

  // Remove pseudo-fullscreen if present
  const visibleIframe = document.querySelector('.backgroundVideo');
  if(visibleIframe){
    visibleIframe.classList.remove('pseudo-fullscreen');
    videoContainer.classList.remove('pseudo-fullscreen');
  }

  // Exit native fullscreen if active
  try {
    if (document.exitFullscreen) document.exitFullscreen();
    else if (document.webkitExitFullscreen) document.webkitExitFullscreen();
  } catch(e){}

  startBtn.style.display = 'block';
  pauseBtn.style.display = 'none';
  toggleOverlay();
});

/* keep overlay non-interactive */
overlay.style.pointerEvents = 'none';
</script>

</body>
</html>