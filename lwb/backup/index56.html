<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<title>CLASH Creator™ — Landing Animation SEO Homepage | Sacrisoft</title>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<meta content="noindex, nofollow" name="robots"/>
<link href="https://cdn.jsdelivr.net/npm/uikit@3.21.6/dist/css/uikit.min.css" rel="stylesheet"/>
<style>
      .editor-section {
        position: relative;
        cursor: grab;
      }
      .editor-remove-btn {
        position: absolute;
        top: 16px;
        right: 32px;
        z-index: 20;
      }
      .editor-edit-btn {
        position: absolute;
        top: 16px;
        left: 20px;
        z-index: 20;
      }
      .live-paragraph { font-size: 1.13rem; max-width: 40em; margin-left:auto; margin-right:auto;}

/* Simple 3-size system for text blocks */
.live-heading.h-sm { font-size: 2.2rem; line-height: 1.15; }
.live-heading.h-md { font-size: 3.2rem; line-height: 1.12; }
.live-heading.h-lg { font-size: 4.2rem; line-height: 1.08; }

.live-subtitle.sub-sm { font-size: 1.1rem; font-weight: 500; }
.live-subtitle.sub-md { font-size: 1.35rem; font-weight: 500; }
.live-subtitle.sub-lg { font-size: 1.7rem; font-weight: 500; }

.live-paragraph.p-sm { font-size: 1.0rem; }
.live-paragraph.p-md { font-size: 1.13rem; }
.live-paragraph.p-lg { font-size: 1.30rem; }

@media (max-width: 640px) {
  .live-heading.h-lg { font-size: 2.6rem; }
  .live-heading.h-md { font-size: 2.0rem; }
  .live-heading.h-sm { font-size: 1.6rem; }

  .live-subtitle.sub-lg { font-size: 1.2rem; }
  .live-subtitle.sub-md { font-size: 1.05rem; }
  .live-subtitle.sub-sm { font-size: 0.95rem; }

  .live-paragraph.p-lg { font-size: 1.05rem; }
  .live-paragraph.p-md { font-size: 0.98rem; }
  .live-paragraph.p-sm { font-size: 0.92rem; }
}

      .live-paragraph.uk-text-large { font-size: 1.45rem; }
      @media (max-width: 640px) {
        .live-paragraph { font-size: 1rem;}
        .live-paragraph.uk-text-large { font-size: 1.1rem;}
      }
      .uk-navbar-container.sticky-colored {
        background: #222 !important;
      }
      .sticky-colored .uk-navbar-item,
      .sticky-colored .uk-navbar-item span,
      .sticky-colored .uk-navbar-item svg,
      .sticky-colored .uk-navbar-item .uk-icon {
        color: #fff !important;
        fill: #fff !important;
      }
      .sticky-colored .uk-navbar-item .uk-icon [stroke] {
        stroke: #fff !important;
      }
      .uk-sortable-handle { cursor: move; }

@media (max-width: 640px) {
  .live-heading, .live-subtitle, .live-paragraph {
    text-align: center !important;
    word-break: break-word;
    white-space: normal;
  }
}      

/* Style the file input button */
#media-file::file-selector-button {
  padding: 10px 20px;       /* make button bigger */
  font-size: 16px;           /* larger text */
  font-weight: bold;         /* optional */
  color: #fff;               /* text color */
  background-color: #000;    /* black button */
  border: none;
  border-radius: 8px;        /* rounded corners */
  cursor: pointer;
  transition: background-color 0.2s;
}

#media-file::file-selector-button:hover {
  background-color: #222;    /* slightly lighter on hover */
}

.navbar-scroll {
  display: flex;
  flex-wrap: nowrap;        /* keep one line */
  gap: 1rem;
  overflow-x: auto;
  white-space: nowrap;      /* keep text on one line */
  -webkit-overflow-scrolling: touch;
  padding: 0.5rem 1rem;
  align-items: center; /* vertical center */
  list-style: none;    /* when used as <ul> */
  margin: 0;
}

.navbar-scroll a {
  flex: 0 0 auto;          /* avoid shrinking/wrapping */
  text-decoration: none;
  color: inherit;
}

.navbar-scroll a.uk-active {
  font-weight: bold;
  border-bottom: 2px solid currentColor;
}

.navbar-group {
  display: flex;
  gap: 0.5rem;
  flex: 0 0 auto;
  align-items: center; /* ensure icons align with text */
}

#nav-title {
  display: flex;
  align-items: center;
  gap: 0.3rem;
}

    
.navbar-logo {
  height: 40px !important;
  width: auto !important;
  max-height: 40px !important;
  object-fit: contain;
  flex-shrink: 0 !important;
  flex-grow: 0 !important;
}
.navbar-scroll {
  display: flex;
  flex-wrap: nowrap;
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
  white-space: nowrap;
  gap: 1rem;
  padding: 0.5rem 1rem;
}
.navbar-scroll li {
  flex: 0 0 auto;
  list-style: none;
}

.visually-hidden {
  position: absolute !important;
  width: 1px; height: 1px;
  margin: -1px; padding: 0; border: 0;
  overflow: hidden; clip: rect(0 0 0 0); clip-path: inset(50%);
  white-space: nowrap;
}

  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0,0,0,0);
  border: 0;
}


:root {
  --navbar-link-color: #000000;
}

.navbar-scroll::-webkit-scrollbar {
  height: 6px;
}
.navbar-scroll::-webkit-scrollbar-thumb {
  background: var(--navbar-link-color);
  border-radius: 3px;
}
.navbar-scroll::-webkit-scrollbar-track {
  background: var(--gray, #eee);
}

.navbar-scroll {
  -ms-overflow-style: none;  /* IE & Edge */
  scrollbar-width: none;     /* Firefox */
}
.navbar-scroll::-webkit-scrollbar {
  display: none;             /* Chrome, Safari, Opera */
}

#main-navbar .navbar-scroll {
  display: flex;
  justify-content: center; /* centers horizontally */
}

#site-title-h1 {
  display: none !important;
}

#dynamic-navbar-container .navbar-scroll a img {
  display: block;
}
#dynamic-navbar-container .navbar-scroll a:has(img) {
  text-decoration: none !important;
  border-bottom: none !important;
}

.wrap {
  min-height:100%;
  display:flex;align-items:center;justify-content:center;
  overflow:hidden;
}
.wrap iframe, .wrap video {
  position:absolute;
  top:50%; left:50%;
  transform:translate(-50%,-50%);
  min-width:100%; min-height:100%;
  width:auto; height:auto;
}

</style>
</head>
<body id="top">
<h1 class="visually-hidden" id="site-title-h1">${siteSettings.title}</h1>
<!-- Sticky Navbar (Toolbar) -->
<nav class="uk-navbar-container uk-navbar-transparent uk-sticky" id="main-navbar" uk-sticky="top: 100; animation: uk-animation-slide-top;">
<div class="navbar-scroll">
<div class="navbar-group">
<a class="uk-icon-button" id="settingsBtn" uk-icon="settings" uk-tooltip="Site Settings"></a>
<a class="uk-icon-button" id="navBarBtn" uk-icon="cog" uk-tooltip="Dynamic Nav Bar"></a>
<a class="uk-icon-button" id="footerBtn" uk-icon="more" uk-tooltip="Footer Settings"></a>
<a class="uk-icon-button" id="addTextBtn" uk-icon="file-text" uk-tooltip="Add Text"></a>
<a class="uk-icon-button" id="addImageBtn" uk-icon="image" uk-tooltip="Add Image"></a>
<a class="uk-icon-button" id="addVideoBtn" uk-icon="video-camera" uk-tooltip="Add Video"></a>
<a class="uk-icon-button" id="embedCodeBtn" uk-icon="code" uk-tooltip="Add Embed Code"></a>
<a class="uk-icon-button" id="previewBtn" uk-icon="eye" uk-tooltip="Preview"></a>
<a class="uk-icon-button" id="saveJSON" uk-icon="download" uk-tooltip="Save as JSON"></a>
<a class="uk-icon-button" id="loadJSON" uk-icon="upload" uk-tooltip="Load JSON"></a>
<a class="uk-icon-button" id="exportHTML" uk-icon="world" uk-tooltip="Export as HTML"></a>
<input accept=".json" id="jsonFileInput" style="display:none" type="file"/>
</div>
</div>
</nav>
<!-- Second navbar container (rendered dynamically below the toolbar in editor) -->
<div id="dynamic-navbar-container"></div>
<ul class="uk-list uk-sortable" id="live-editor-root" uk-sortable="handle: .editor-section"></ul>
<!-- Modal: media edit -->
<div id="media-modal" uk-modal="">
<div class="uk-modal-dialog uk-modal-body uk-border-rounded">
<button class="uk-modal-close-default uk-border-rounded" type="button" uk-close=""></button>
<h3 class="uk-modal-title" id="media-modal-title">Add Media</h3>
<form id="media-form">
<input id="section-index" type="hidden" value=""/>
<ul uk-accordion="multiple:true">
<li class="uk-open">
<a class="uk-accordion-title" href="#">Section Options</a>
<div class="uk-accordion-content">
<div class="uk-margin">
<label class="uk-form-label">From URL</label>
<input class="uk-input uk-border-rounded" id="media-url" placeholder="Paste URL" type="url"/>
</div>
<div class="uk-margin">
<label class="uk-form-label">Or Upload</label><br/>
<input accept="" id="media-file" type="file"/>
<div class="uk-text-meta uk-margin-small-top" id="prev-file" style="display:none;">
                                    Previous file: <span id="prev-file-name"></span>
<label><input checked="" id="keep-prev-file" type="checkbox"/> Keep previous file</label>
</div>
<div class="uk-margin" id="youtube-vimeo-options" style="display:none;">
  <label class="uk-form-label">Or YouTube / Vimeo</label><br>
  <button type="button" class="uk-button uk-button-default uk-border-rounded" onclick="promptYouTube()"><span uk-icon="icon: youtube; ratio: 1.2"></span> YouTube</button>
  <button type="button" class="uk-button uk-button-default uk-border-rounded" onclick="promptVimeo()"><span uk-icon="icon: vimeo; ratio: 1.2"></span> Vimeo</button>
</div>
</div>
<div class="uk-margin">
<label class="uk-form-label">Media Size &amp; Position</label>
<select class="uk-select uk-border-rounded" id="media-size">
<option value="full">Full Screen</option>
<option value="left">Small Left</option>
<option value="center">Small Center</option>
<option value="right">Small Right</option>
</select>
</div>
<div class="uk-margin">
<label class="uk-form-label">Background Color</label>
<input id="bg-color" type="color" value="#000000"/>
</div>
</div>
</li>
<li>
<a class="uk-accordion-title" href="#">Heading Options</a>
<div class="uk-accordion-content">
<div class="uk-margin">
<label class="uk-form-label">Heading</label>
<input class="uk-input uk-border-rounded" id="media-heading" type="text" value="Your Headline Here"/>
</div>
<div class="uk-margin">
<label class="uk-form-label">Heading Size</label>
<select class="uk-select uk-border-rounded" id="heading-size">
<option value="uk-heading-large">Small</option>
<option value="uk-heading-xlarge">Medium</option>
<option selected="" value="uk-heading-2xlarge">Large</option>
</select>
</div>
<div class="uk-margin">
<label class="uk-form-label">Heading Color</label>
<input id="media-color" type="color" value="#ffffff"/>
</div>
</div>
</li>
<li>
<a class="uk-accordion-title" href="#">Text Options</a>
<div class="uk-accordion-content">
<div class="uk-margin">
<label class="uk-form-label">Subtitle</label>
<input class="uk-input uk-border-rounded" id="media-subtitle" placeholder="Your Subtitle" type="text"/>
</div>
<div class="uk-margin">
<label class="uk-form-label">Subtitle Size</label>
<select class="uk-select uk-border-rounded" id="subtitle-size">
<option value="uk-heading-medium">Small</option>
<option value="uk-heading-large">Medium</option>
<option value="uk-heading-xlarge">Large</option>
</select>
</div>
<div class="uk-margin">
<label class="uk-form-label">Subtitle Color</label>
<input id="subtitle-color" type="color" value="#ffffff"/>
</div>
<div class="uk-margin">
<label class="uk-form-label">Paragraph</label>
<textarea class="uk-textarea uk-border-rounded" id="media-paragraph" placeholder="Add an optional description or paragraph" rows="6"></textarea>
</div>
<div class="uk-margin" style="display:none;">
<label class="uk-form-label">Paragraph Size</label>
<select class="uk-select uk-border-rounded" id="paragraph-size">
<option value="large">Default</option>
</select>
</div>
<div class="uk-margin">
<label class="uk-form-label">Paragraph Color</label>
<input id="paragraph-color" type="color" value="#ffffff"/>
</div>
</div>
</li>
<li>
<a class="uk-accordion-title" href="#">Button Options</a>
<div class="uk-accordion-content">
<div class="uk-margin">
<label class="uk-form-label">Button Label</label>
<input class="uk-input uk-border-rounded" id="btn-label" placeholder="(Optional)" type="text"/>
</div>
<div class="uk-margin">
<label class="uk-form-label">Button URL</label>
<input class="uk-input uk-border-rounded" id="btn-url" placeholder="https://your-link.com" type="url"/>
</div>
<div class="uk-margin">
<label class="uk-form-label">Button Style</label>
<select class="uk-select uk-border-rounded" id="btn-color">
<option value="default">Default</option>
<option value="primary">Light</option>
<option value="secondary">Dark</option>
<option value="text">Text</option>
</select>
</div>
</div>
</li>
</ul>
<button class="uk-button uk-button-primary uk-width-1-1 uk-margin-top uk-border-rounded" type="submit">Save</button>
</form>
</div>
</div>
<!-- Modal: embed -->
<div id="embed-modal" uk-modal="">
<div class="uk-modal-dialog uk-modal-body uk-border-rounded">
<button class="uk-modal-close-default uk-border-rounded" type="button" uk-close=""></button>
<h3 class="uk-modal-title" id="embed-modal-title">Add Embed Code</h3>
<form id="embed-form">
<input id="embed-index" type="hidden" value=""/>
<div class="uk-margin">
<label class="uk-form-label">Paste Code</label>
<textarea class="uk-textarea uk-border-rounded" id="embed-code" placeholder="Paste HTML, CSS, or JS here" rows="8"></textarea>
</div>
<div class="uk-margin">
  <label class="uk-form-label">Background Color</label>
  <input id="embed-bgcolor" type="color" value="#000000" />
</div>
<button class="uk-button uk-button-primary uk-width-1-1 uk-margin-top uk-border-rounded" type="submit">Save</button>
</form>
</div>
</div>
<!-- Modal: text -->
<div id="text-modal" uk-modal="">
<div class="uk-modal-dialog uk-modal-body uk-border-rounded">
<button class="uk-modal-close-default uk-border-rounded" type="button" uk-close=""></button>
<h3 class="uk-modal-title" id="text-modal-title">Add Animated Text</h3>
<form id="text-form">
<input id="text-index" type="hidden" value=""/>
<div class="uk-margin">
<label class="uk-form-label">Heading</label>
<input class="uk-input uk-border-rounded" id="text-heading" placeholder="Your Headline Here" type="text"/>
<select class="uk-select uk-border-rounded uk-margin-small-top" id="text-heading-size">
<option value="h-sm">Small</option>
<option value="h-md">Medium</option>
<option selected="" value="h-lg">Large</option>
</select>
</div>
<div class="uk-margin">
<label class="uk-form-label">Subheading</label>
<input class="uk-input uk-border-rounded" id="text-subtitle" placeholder="Your Subtitle" type="text"/>
<select class="uk-select uk-border-rounded uk-margin-small-top" id="text-subtitle-size">
<option value="sub-sm">Small</option>
<option selected="" value="sub-md">Medium</option>
<option value="sub-lg">Large</option>
</select>
</div>
<div class="uk-margin">
<label class="uk-form-label">Paragraph</label>
<div class="toolbar uk-margin-small-bottom">
<button class="uk-icon-button" onclick="formatText('bold')" type="button" uk-icon="bold" uk-tooltip="title:Bold Style; pos:bottom"></button>
<button class="uk-icon-button" onclick="formatText('italic')" type="button" uk-icon="italic" uk-tooltip="title:Italic Style; pos:bottom"></button>
<button class="uk-icon-button" onmousedown="addLink(); return false;" tabindex="-1" type="button" uk-icon="link" uk-tooltip="title:Add Link; pos:bottom"></button>
<button class="uk-icon-button" onmousedown="removeLink(); return false;" tabindex="-1" type="button" uk-icon="ban" uk-tooltip="title:Remove Link; pos:bottom"></button>
</div>
<div class="uk-textarea uk-border-rounded" contenteditable="true" id="text-paragraph" style="min-height:120px;"></div>
<select class="uk-select uk-border-rounded uk-margin-small-top" id="text-paragraph-size">
<option value="p-sm">Small</option>
<option selected="" value="p-md">Medium</option>
<option value="p-lg">Large</option>
</select>
</div>
<div class="uk-margin">
<label class="uk-form-label">Animation Style</label>
<select class="uk-select uk-border-rounded" id="text-animation">
<option value="uk-animation-fade">Fade</option>
<option value="uk-animation-slide-top">Slide Top</option>
<option value="uk-animation-slide-bottom">Slide Bottom</option>
<option value="uk-animation-slide-left">Slide Left</option>
<option value="uk-animation-slide-right">Slide Right</option>
</select>
</div>
<div class="uk-margin">
<label class="uk-form-label">Background Color</label>
<input id="text-bgcolor" type="color" value="#000000"/>
</div>
<div class="uk-margin">
<label class="uk-form-label">Text Color</label>
<input id="text-color" type="color" value="#ffffff"/>
</div>
<button class="uk-button uk-button-primary uk-width-1-1 uk-border-rounded" type="submit">Save</button>
</form>
</div>
</div>
<!-- Modal: site settings -->
<div id="settings-modal" uk-modal="">
<div class="uk-modal-dialog uk-modal-body uk-border-rounded">
<button class="uk-modal-close-default uk-border-rounded" type="button" uk-close=""></button>
<h3 class="uk-modal-title">Site Settings</h3>
<form id="settings-form">
<div class="uk-margin">
<label class="uk-form-label">Site Language</label>
<select class="uk-select uk-border-rounded" id="site-language">
<option selected="" value="en">English</option>
<option value="it">Italian</option>
<option value="fr">French</option>
<option value="de">German</option>
<!-- (list trimmed for brevity, keep your full list if needed) -->
</select>
</div>
<div class="uk-margin">
<label class="uk-form-label">Website Title</label>
<input class="uk-input uk-border-rounded" id="site-title" placeholder="My Awesome Site" type="text"/>
</div>
<div class="uk-margin">
<label class="uk-form-label">Description</label>
<textarea class="uk-textarea uk-border-rounded" id="site-description" placeholder="CLASH Creator™ — Landing Animation SEO Homepage" rows="2"></textarea>
</div>
<div class="uk-margin">
<label class="uk-form-label">Robots</label>
<select class="uk-select uk-border-rounded" id="site-robots">
<option value="index, follow">Index, Follow</option>
<option value="noindex, nofollow">NoIndex, NoFollow</option>
</select>
</div>
<div class="uk-margin">
<label class="uk-form-label">Author</label>
<input class="uk-input uk-border-rounded" id="site-author" placeholder="Sacrisoft" type="text"/>
</div>
<div class="uk-margin">
<label class="uk-form-label">Favicon URL</label>
<input class="uk-input uk-border-rounded" id="site-favicon" placeholder="https://example.com/favicon.ico" type="url"/>
<div class="uk-margin-small-top">
<label class="uk-form-label">Or Upload Favicon</label>
<input accept="image/x-icon,image/png,image/svg+xml,image/jpeg,image/jpg,image/webp" id="site-favicon-file" type="file"/>
<div class="uk-margin-small-top" id="site-favicon-preview" style="max-height:40px;"></div>
</div>
</div>
<div class="uk-margin">
<label class="uk-form-label">Social Preview Image URL</label>
<input class="uk-input uk-border-rounded" id="site-social" placeholder="https://example.com/social.png" type="url"/>
<div class="uk-margin-small-top">
<label class="uk-form-label">Or Upload Social Image</label>
<input accept="image/*" id="site-social-file" type="file"/>
<div class="uk-margin-small-top" id="site-social-preview" style="max-height:80px;"></div>
</div>
</div>
<div class="uk-margin">
<label class="uk-form-label">Insert custom Schema.org JSON code</label>
<textarea class="uk-textarea uk-border-rounded" id="site-head-script" placeholder='&lt;script type="application/ld+json"&gt;...&lt;/script&gt;' rows="4"></textarea>
<p uk-lightbox="">
<a class="uk-button uk-button-secondary uk-border-pill uk-margin-small" data-type="iframe" href="https://artoldo.com/embassyofthefreemind/index.html">Generate Code</a>
</p>
</div>

<div class="uk-margin">
<label class="uk-form-label">Custom CSS</label><textarea class="uk-textarea uk-border-rounded" id="site-custom-css" placeholder="Write custom CSS here..." rows="6"></textarea></div><div class="uk-margin">
</div>

<div class="uk-margin">
  <label class="uk-form-label">Google Font Name</label><input class="uk-input uk-border-rounded" id="site-font-name" placeholder="e. g. Orbitron" type="text"/>
  <label class="uk-form-label">Apply Google Font To</label>
  <div class="uk-form-controls">
    <label><input type="radio" name="font-target" value="all" id="apply-to-all"> All (Text + Headings)</label><br>
    <label><input type="radio" name="font-target" value="body" id="apply-to-body"> Text</label><br>
    <label><input type="radio" name="font-target" value="headings" id="apply-to-headings"> Headings</label><br>
    <label><input type="radio" name="font-target" value="none" id="apply-to-none" checked> None</label>
  </div>
</div>

<button class="uk-button uk-button-primary uk-width-1-1 uk-margin-top uk-border-rounded" type="submit">Save</button>

</form>
</div>
</div>
<!-- UIKit modal for delete warning -->
<div id="delete-modal" uk-modal="">
<div class="uk-modal-dialog uk-modal-body">
<h2 class="uk-modal-title">Really delete item?</h2>
<p>This action cannot be undone.</p>
<p class="uk-text-right">
<button class="uk-button uk-button-default uk-modal-close" type="button">Cancel</button>
<button class="uk-button uk-button-danger uk-border-rounded" id="confirm-delete" type="button">Delete</button>
</p>
</div>
</div>
<!-- Footer Settings Modal -->
<div id="footer-modal" uk-modal="">
<div class="uk-modal-dialog uk-modal-body uk-border-rounded">
<button class="uk-modal-close-default uk-border-rounded" type="button" uk-close=""></button>
<h3 class="uk-modal-title">Footer Settings</h3>
<form id="footer-form">
<div class="uk-margin">
<label><input id="enable-footer" type="checkbox"/> Enable Footer</label>
</div>
<div class="uk-margin">
<label class="uk-form-label">Background Color</label>
<input id="footer-bg" type="color" value="#222222"/>
</div>
<div class="uk-margin">
<label class="uk-form-label">Text Color</label>
<input id="footer-text" type="color" value="#ffffff"/>
</div>
<div class="uk-margin">
<label class="uk-form-label">Phone</label>
<div class="uk-inline uk-width-1-1">
<span class="uk-form-icon" uk-icon="receiver"></span>
<input class="uk-input uk-border-rounded" id="footer-phone" placeholder="+1 (555) 123-4567" type="tel"/>
</div>
</div>
<div class="uk-margin">
<label class="uk-form-label">Email</label>
<div class="uk-inline uk-width-1-1">
<span class="uk-form-icon" uk-icon="mail"></span>
<input class="uk-input uk-border-rounded" id="footer-email" placeholder="you@example.com" type="email"/>
</div>
</div>
<div class="uk-margin">
<label class="uk-form-label">Address</label>
<div class="uk-inline uk-width-1-1">
<span class="uk-form-icon" uk-icon="location"></span>
<input class="uk-input uk-border-rounded" id="footer-address" placeholder="123 Main St, City, Country" type="text"/>
</div>
<h4 class="uk-heading-bullet" uk-tooltip="Website Links open within a Lightbox window">Lightbox Links (URL)</h4>
<div class="uk-grid-small" uk-grid="">
<div class="uk-width-1-2">
<div class="uk-inline uk-width-1-1">
<span class="uk-form-icon" uk-icon="info"></span>
<input class="uk-input uk-border-rounded" id="footer-info" placeholder="About" type="url"/>
</div>
</div>
<div class="uk-width-1-2">
<div class="uk-inline uk-width-1-1">
<span class="uk-form-icon" uk-icon="comments"></span>
<input class="uk-input uk-border-rounded" id="footer-comments" placeholder="Community" type="url"/>
</div>
</div>
<div class="uk-width-1-2">
<div class="uk-inline uk-width-1-1">
<span class="uk-form-icon" uk-icon="mail"></span>
<input class="uk-input uk-border-rounded" id="footer-mail" placeholder="Contact" type="url"/>
</div>
</div>
<div class="uk-width-1-2">
<div class="uk-inline uk-width-1-1">
<span class="uk-form-icon" uk-icon="heart"></span>
<input class="uk-input uk-border-rounded" id="footer-herat" placeholder="Donate" type="url"/>
</div>
</div>
<div class="uk-width-1-2">
<div class="uk-inline uk-width-1-1">
<span class="uk-form-icon" uk-icon="calendar"></span>
<input class="uk-input uk-border-rounded" id="footer-calendar" placeholder="Events" type="url"/>
</div>
</div>
<div class="uk-width-1-2">
<div class="uk-inline uk-width-1-1">
<span class="uk-form-icon" uk-icon="question"></span>
<input class="uk-input uk-border-rounded" id="footer-question" placeholder="FAQ" type="url"/>
</div>
</div>
<div class="uk-width-1-2">
<div class="uk-inline uk-width-1-1">
<span class="uk-form-icon" uk-icon="rss"></span>
<input class="uk-input uk-border-rounded" id="footer-rss" placeholder="Feed" type="url"/>
</div>
</div>
<div class="uk-width-1-2">
<div class="uk-inline uk-width-1-1">
<span class="uk-form-icon" uk-icon="star"></span>
<input class="uk-input uk-border-rounded" id="footer-star" placeholder="Jobs" type="url"/>
</div>
</div>
<div class="uk-width-1-2">
<div class="uk-inline uk-width-1-1">
<span class="uk-form-icon" uk-icon="bell"></span>
<input class="uk-input uk-border-rounded" id="footer-bell" placeholder="News" type="url"/>
</div>
</div>
<div class="uk-width-1-2">
<div class="uk-inline uk-width-1-1">
<span class="uk-form-icon" uk-icon="users"></span>
<input class="uk-input uk-border-rounded" id="footer-users" placeholder="Organization" type="url"/>
</div>
</div>
<div class="uk-width-1-2">
<div class="uk-inline uk-width-1-1">
<span class="uk-form-icon" uk-icon="social"></span>
<input class="uk-input uk-border-rounded" id="footer-social" placeholder="Press" type="url"/>
</div>
</div>
<div class="uk-width-1-2">
<div class="uk-inline uk-width-1-1">
<span class="uk-form-icon" uk-icon="lock"></span>
<input class="uk-input uk-border-rounded" id="footer-lock" placeholder="Privacy" type="url"/>
</div>
</div>
<div class="uk-width-1-2">
<div class="uk-inline uk-width-1-1">
<span class="uk-form-icon" uk-icon="cart"></span>
<input class="uk-input uk-border-rounded" id="footer-cart" placeholder="Shop" type="url"/>
</div>
</div>
<div class="uk-width-1-2">
<div class="uk-inline uk-width-1-1">
<span class="uk-form-icon" uk-icon="hashtag"></span>
<input class="uk-input uk-border-rounded" id="footer-hashtag" placeholder="Social Wall" type="url"/>
</div>
</div>
<div class="uk-width-1-2">
<div class="uk-inline uk-width-1-1">
<span class="uk-form-icon" uk-icon="warning"></span>
<input class="uk-input uk-border-rounded" id="footer-warning" placeholder="Status" type="url"/>
</div>
</div>
<div class="uk-width-1-2">
<div class="uk-inline uk-width-1-1">
<span class="uk-form-icon" uk-icon="tag"></span>
<input class="uk-input uk-border-rounded" id="footer-tag" placeholder="Tags" type="url"/>
</div>
</div>
<div class="uk-width-1-2">
<div class="uk-inline uk-width-1-1">
<span class="uk-form-icon" uk-icon="menu"></span>
<input class="uk-input uk-border-rounded" id="footer-menu" placeholder="Terms" type="url"/>
</div>
</div>
<div class="uk-width-1-2">
<div class="uk-inline uk-width-1-1">
<span class="uk-form-icon" uk-icon="user"></span>
<input class="uk-input uk-border-rounded" id="footer-user" placeholder="User" type="url"/>
</div>
</div>
</div>
<h4 class="uk-heading-bullet" uk-tooltip="Social Links open in an external window">Social Links (URL)</h4>
<div class="uk-grid-small" uk-grid="">
<div class="uk-width-1-2">
<div class="uk-inline uk-width-1-1">
<span class="uk-form-icon" uk-icon="android-robot"></span>
<input class="uk-input uk-border-rounded" id="footer-android-robot" placeholder="Android" type="url"/>
</div>
</div>
<div class="uk-width-1-2">
<div class="uk-inline uk-width-1-1">
<span class="uk-form-icon" uk-icon="apple"></span>
<input class="uk-input uk-border-rounded" id="footer-apple" placeholder="Apple" type="url"/>
</div>
</div>
<div class="uk-width-1-2">
<div class="uk-inline uk-width-1-1">
<span class="uk-form-icon" uk-icon="behance"></span>
<input class="uk-input uk-border-rounded" id="footer-behance" placeholder="Behance" type="url"/>
</div>
</div>
<div class="uk-width-1-2">
<div class="uk-inline uk-width-1-1">
<span class="uk-form-icon" uk-icon="discord"></span>
<input class="uk-input uk-border-rounded" id="footer-discord" placeholder="Discord" type="url"/>
</div>
</div>
<div class="uk-width-1-2">
<div class="uk-inline uk-width-1-1">
<span class="uk-form-icon" uk-icon="dribbble"></span>
<input class="uk-input uk-border-rounded" id="footer-dribbble" placeholder="Dribbble" type="url"/>
</div>
</div>
<div class="uk-width-1-2">
<div class="uk-inline uk-width-1-1">
<span class="uk-form-icon" uk-icon="etsy"></span>
<input class="uk-input uk-border-rounded" id="footer-etsy" placeholder="Etsy" type="url"/>
</div>
</div>
<div class="uk-width-1-2">
<div class="uk-inline uk-width-1-1">
<span class="uk-form-icon" uk-icon="facebook"></span>
<input class="uk-input uk-border-rounded" id="footer-facebook" placeholder="Facebook" type="url"/>
</div>
</div>
<div class="uk-width-1-2">
<div class="uk-inline uk-width-1-1">
<span class="uk-form-icon" uk-icon="flickr"></span>
<input class="uk-input uk-border-rounded" id="footer-flickr" placeholder="Flickr" type="url"/>
</div>
</div>
<div class="uk-width-1-2">
<div class="uk-inline uk-width-1-1">
<span class="uk-form-icon" uk-icon="foursquare"></span>
<input class="uk-input uk-border-rounded" id="footer-foursquare" placeholder="Foursquare" type="url"/>
</div>
</div>
<div class="uk-width-1-2">
<div class="uk-inline uk-width-1-1">
<span class="uk-form-icon" uk-icon="github"></span>
<input class="uk-input uk-border-rounded" id="footer-github" placeholder="GitHub" type="url"/>
</div>
</div>
<div class="uk-width-1-2">
<div class="uk-inline uk-width-1-1">
<span class="uk-form-icon" uk-icon="google"></span>
<input class="uk-input uk-border-rounded" id="footer-google" placeholder="Google" type="url"/>
</div>
</div>
<div class="uk-width-1-2">
<div class="uk-inline uk-width-1-1">
<span class="uk-form-icon" uk-icon="instagram"></span>
<input class="uk-input uk-border-rounded" id="footer-instagram" placeholder="Instagram" type="url"/>
</div>
</div>
<div class="uk-width-1-2">
<div class="uk-inline uk-width-1-1">
<span class="uk-form-icon" uk-icon="joomla"></span>
<input class="uk-input uk-border-rounded" id="footer-joomla" placeholder="Joomla" type="url"/>
</div>
</div>
<div class="uk-width-1-2">
<div class="uk-inline uk-width-1-1">
<span class="uk-form-icon" uk-icon="linkedin"></span>
<input class="uk-input uk-border-rounded" id="footer-linkedin" placeholder="LinkedIn" type="url"/>
</div>
</div>
<div class="uk-width-1-2">
<div class="uk-inline uk-width-1-1">
<span class="uk-form-icon" uk-icon="mastodon"></span>
<input class="uk-input uk-border-rounded" id="footer-mastodon" placeholder="Mastodon" type="url"/>
</div>
</div>
<div class="uk-width-1-2">
<div class="uk-inline uk-width-1-1">
<span class="uk-form-icon" uk-icon="microsoft"></span>
<input class="uk-input uk-border-rounded" id="footer-microsoft" placeholder="Microsoft" type="url"/>
</div>
</div>
<div class="uk-width-1-2">
<div class="uk-inline uk-width-1-1">
<span class="uk-form-icon" uk-icon="pinterest"></span>
<input class="uk-input uk-border-rounded" id="footer-pinterest" placeholder="Pinterest" type="url"/>
</div>
</div>
<div class="uk-width-1-2">
<div class="uk-inline uk-width-1-1">
<span class="uk-form-icon" uk-icon="reddit"></span>
<input class="uk-input uk-border-rounded" id="footer-reddit" placeholder="Reddit" type="url"/>
</div>
</div>
<div class="uk-width-1-2">
<div class="uk-inline uk-width-1-1">
<span class="uk-form-icon" uk-icon="bag"></span>
<input class="uk-input uk-border-rounded" id="footer-bag" placeholder="Shopify" type="url"/>
</div>
</div>
<div class="uk-width-1-2">
<div class="uk-inline uk-width-1-1">
<span class="uk-form-icon" uk-icon="signal"></span>
<input class="uk-input uk-border-rounded" id="footer-signal" placeholder="Signal" type="url"/>
</div>
</div>
<div class="uk-width-1-2">
<div class="uk-inline uk-width-1-1">
<span class="uk-form-icon" uk-icon="soundcloud"></span>
<input class="uk-input uk-border-rounded" id="footer-soundcloud" placeholder="SoundCloud" type="url"/>
</div>
</div>
<div class="uk-width-1-2">
<div class="uk-inline uk-width-1-1">
<span class="uk-form-icon" uk-icon="telegram"></span>
<input class="uk-input uk-border-rounded" id="footer-telegram" placeholder="Telegram" type="url"/>
</div>
</div>
<div class="uk-width-1-2">
<div class="uk-inline uk-width-1-1">
<span class="uk-form-icon" uk-icon="threads"></span>
<input class="uk-input uk-border-rounded" id="footer-threads" placeholder="Threads" type="url"/>
</div>
</div>
<div class="uk-width-1-2">
<div class="uk-inline uk-width-1-1">
<span class="uk-form-icon" uk-icon="tiktok"></span>
<input class="uk-input uk-border-rounded" id="footer-tiktok" placeholder="TikTok" type="url"/>
</div>
</div>
<div class="uk-width-1-2">
<div class="uk-inline uk-width-1-1">
<span class="uk-form-icon" uk-icon="tripadvisor"></span>
<input class="uk-input uk-border-rounded" id="footer-tripadvisor" placeholder="Tripadvisor" type="url"/>
</div>
</div>
<div class="uk-width-1-2">
<div class="uk-inline uk-width-1-1">
<span class="uk-form-icon" uk-icon="tumblr"></span>
<input class="uk-input uk-border-rounded" id="footer-tumblr" placeholder="Tumblr" type="url"/>
</div>
</div>
<div class="uk-width-1-2">
<div class="uk-inline uk-width-1-1">
<span class="uk-form-icon" uk-icon="twitch"></span>
<input class="uk-input uk-border-rounded" id="footer-twitch" placeholder="Twitch" type="url"/>
</div>
</div>
<div class="uk-width-1-2">
<div class="uk-inline uk-width-1-1">
<span class="uk-form-icon" uk-icon="vimeo"></span>
<input class="uk-input uk-border-rounded" id="footer-vimeo" placeholder="Vimeo" type="url"/>
</div>
</div>
<div class="uk-width-1-2">
<div class="uk-inline uk-width-1-1">
<span class="uk-form-icon" uk-icon="whatsapp"></span>
<input class="uk-input uk-border-rounded" id="footer-whatsapp" placeholder="WhatsApp" type="url"/>
</div>
</div>
<div class="uk-width-1-2">
<div class="uk-inline uk-width-1-1">
<span class="uk-form-icon" uk-icon="wordpress"></span>
<input class="uk-input uk-border-rounded" id="footer-wordpress" placeholder="WordPress" type="url"/>
</div>
</div>
<div class="uk-width-1-2">
<div class="uk-inline uk-width-1-1">
<span class="uk-form-icon" uk-icon="x"></span>
<input class="uk-input uk-border-rounded" id="footer-x" placeholder="X (Twitter)" type="url"/>
</div>
</div>
<div class="uk-width-1-2">
<div class="uk-inline uk-width-1-1">
<span class="uk-form-icon" uk-icon="xing"></span>
<input class="uk-input uk-border-rounded" id="footer-xing" placeholder="Xing" type="url"/>
</div>
</div>
<div class="uk-width-1-2">
<div class="uk-inline uk-width-1-1">
<span class="uk-form-icon" uk-icon="yelp"></span>
<input class="uk-input uk-border-rounded" id="footer-yelp" placeholder="Yelp" type="url"/>
</div>
</div>
<div class="uk-width-1-2">
<div class="uk-inline uk-width-1-1">
<span class="uk-form-icon" uk-icon="youtube"></span>
<input class="uk-input uk-border-rounded" id="footer-youtube" placeholder="YouTube" type="url"/>
</div>
</div>
<div class="uk-width-1-2">
<div class="uk-inline uk-width-1-1">
<span class="uk-form-icon" uk-icon="link"></span>
<input class="uk-input uk-border-rounded" id="footer-link" placeholder="Custom URL" type="url"/>
</div>
</div>
<div class="uk-width-1-2">
<div class="uk-inline uk-width-1-1">
<span class="uk-form-icon" uk-icon="link-external"></span>
<input class="uk-input uk-border-rounded" id="external" placeholder="Website URL" type="url"/>
</div>
</div>
</div>
</div>
<button class="uk-button uk-button-primary uk-width-1-1 uk-border-rounded" type="submit">Save</button>
</form>
</div>
</div>
<!-- NEW: Dynamic Nav Bar Settings Modal -->
<div id="navbar-modal" uk-modal="">
<div class="uk-modal-dialog uk-modal-body uk-border-rounded">
<button class="uk-modal-close-default uk-border-rounded" type="button" uk-close=""></button>
<h3 class="uk-modal-title">Dynamic Nav Bar Settings</h3>
<form id="navbar-form">
<div class="uk-margin"><label><input id="enable-navbar" type="checkbox"/> Enable Dynamic Nav Bar</label></div>
<div class="uk-margin"><label class="uk-form-label">Background Color</label><input id="navbar-bg" type="color" value="#ffffff"/></div>
<div class="uk-margin"><label class="uk-form-label">Text Color</label><input id="navbar-text" type="color" value="#000000"/></div>
<div class="uk-margin">
<label class="uk-form-label">Logo From URL</label>
<input class="uk-input uk-border-rounded" id="navbar-logo-url" placeholder="https://example.com/logo.png" type="url"/>
<div class="uk-margin-small-top" id="navbar-logo-url-preview" style="max-height:50px;"></div>
</div>
<div class="uk-margin">
<label class="uk-form-label">Or Upload Logo</label>
<input accept="image/*" id="navbar-logo" type="file"/>
<div class="uk-margin-small-top" id="navbar-logo-preview" style="max-height:50px;"></div>
</div>
<button class="uk-button uk-button-primary uk-width-1-1 uk-border-rounded" type="submit">Save</button>
</form>
</div>
</div>
<!-- JSZip for export -->
<script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/uikit@3.21.6/dist/js/uikit.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/uikit@3.21.6/dist/js/uikit-icons.min.js"></script>
<script>
function applyFontLink() {
  if (siteSettings.fontName) {
    const urlName = siteSettings.fontName.trim().replace(/ /g, '+');
    const fontUrl = `https://fonts.googleapis.com/css2?family=${urlName}&display=swap`;
    let link = document.getElementById("custom-font-link");
    if (!link) {
      link = document.createElement("link");
      link.id = "custom-font-link";
      link.rel = "stylesheet";
      document.head.appendChild(link);
    }
    link.href = fontUrl;
  }
}

function getFontNameFromUrl(url) {
  if (!url) return '';
  const match = url.match(/family=([^:&]+)/);
  if (match && match[1]) {
    return match[1].replace(/\+/g, ' ').split(':')[0];
  }
  return '';
}

function generateFontCSS() {
  let css = "";
  if (siteSettings.fontName) {
    switch (siteSettings.fontTarget) {
      case 'all':
        css += `body, h1, h2, h3, h4, h5, h6, .live-heading { font-family: '${siteSettings.fontName}', sans-serif; }\n`;
        break;
      case 'body':
        css += `body { font-family: '${siteSettings.fontName}', sans-serif; }\n`;
        break;
      case 'headings':
        css += `h1, h2, h3, h4, h5, h6, .live-heading { font-family: '${siteSettings.fontName}', sans-serif; }\n`;
        break;
      case 'none':
      default:
        // no font applied
        break;
    }
  }
  return css;
}

        // Sticky nav color swap
        UIkit.util.on(document, 'DOMContentLoaded', function(){
            var stickyNav = document.getElementById('main-navbar');
            UIkit.util.on(window, 'scroll', function() {
                const stickyActive = stickyNav.classList.contains('uk-sticky-fixed');
                stickyNav.classList.toggle('sticky-colored', stickyActive);
            });
        });

        // Editor logic
        const editorRoot = document.getElementById('live-editor-root');
        const addImageBtn = document.getElementById('addImageBtn');
        const addVideoBtn = document.getElementById('addVideoBtn');
        const mediaModal = UIkit.modal('#media-modal');
        const mediaForm = document.getElementById('media-form');
        const mediaUrl = document.getElementById('media-url');
        const mediaFile = document.getElementById('media-file');
        const prevFile = document.getElementById('prev-file');
        const prevFileName = document.getElementById('prev-file-name');
        const keepPrevFile = document.getElementById('keep-prev-file');
        const mediaHeading = document.getElementById('media-heading');
        const headingSize = document.getElementById('heading-size');
        const mediaColor = document.getElementById('media-color');
        const mediaModalTitle = document.getElementById('media-modal-title');
        const mediaSize = document.getElementById('media-size');
        const bgColor = document.getElementById('bg-color');
        const btnLabel = document.getElementById('btn-label');
        const btnUrl = document.getElementById('btn-url');
        const btnColor = document.getElementById('btn-color');
        const sectionIndex = document.getElementById('section-index');
        const embedCodeBtn = document.getElementById('embedCodeBtn');
        const embedModal = UIkit.modal('#embed-modal');
        const embedForm = document.getElementById('embed-form');
        const embedCode = document.getElementById('embed-code');
        const embedIndex = document.getElementById('embed-index');


// Text modal setup
const addTextBtn = document.getElementById('addTextBtn');
const textModal = UIkit.modal('#text-modal');
const textForm = document.getElementById('text-form');
const textHeading = document.getElementById('text-heading');
const textSubtitle = document.getElementById('text-subtitle');
const textParagraph = document.getElementById('text-paragraph'); // now a contenteditable div
const textAnimation = document.getElementById('text-animation');
const textIndex = document.getElementById('text-index');
const textBgColor = document.getElementById('text-bgcolor');
const textColor   = document.getElementById('text-color');
const textHeadingSize  = document.getElementById('text-heading-size');
const textSubtitleSize = document.getElementById('text-subtitle-size');
const textParagraphSize = document.getElementById('text-paragraph-size');

addTextBtn.addEventListener('click', () => {
  textHeading.value = '';
  textSubtitle.value = '';
  textParagraph.value = '';
  textAnimation.value = 'uk-animation-fade';
  if (typeof textHeadingSize !== 'undefined')  textHeadingSize.value  = 'h-lg';
  if (typeof textSubtitleSize !== 'undefined') textSubtitleSize.value = 'sub-md';
  if (typeof textParagraphSize !== 'undefined') textParagraphSize.value = 'p-md';
  if (typeof textBgColor !== 'undefined') textBgColor.value = '#000000';
  if (typeof textColor !== 'undefined')   textColor.value   = '#ffffff';
  textIndex.value = '';
  textModal.show();
});

textForm.addEventListener('submit', e => {
  e.preventDefault();
  let block = {
    id: 'sec-' + Math.random().toString(36).substr(2, 9),
    type: 'text',
    heading: textHeading.value,
    subtitle: textSubtitle.value,
    paragraph: textParagraph.innerHTML,
    animation: textAnimation.value,
    bgColor: textBgColor.value || '#000000',
    textColor: textColor.value || '#ffffff',
    headingSize: textHeadingSize.value,
    subtitleSize: textSubtitleSize.value,
    paragraphSize: textParagraphSize.value
  };
  let idx = textIndex.value ? parseInt(textIndex.value) : null;
  if (idx !== null && !isNaN(idx)) {
    allSections[idx] = block;
  } else {
    allSections.push(block);
  }
  renderAllSections();
      applyFontLink();
      applyCustomCSS();
  textModal.hide();
});


        // New fields for subtitle/paragraph
        const mediaSubtitle = document.getElementById('media-subtitle');
        const subtitleSize = document.getElementById('subtitle-size');
        const subtitleColor = document.getElementById('subtitle-color');
        const mediaParagraph = document.getElementById('media-paragraph');
        const paragraphSize = document.getElementById('paragraph-size');
        const paragraphColor = document.getElementById('paragraph-color');

        // JSON/HTML
        const saveJSONBtn = document.getElementById('saveJSON');
        const loadJSONBtn = document.getElementById('loadJSON');
        const exportHTMLBtn = document.getElementById('exportHTML');
        const jsonFileInput = document.getElementById('jsonFileInput');
        const deleteModal = UIkit.modal('#delete-modal');
        const confirmDeleteBtn = document.getElementById('confirm-delete');

        // NEW: Dynamic Nav Bar controls
        const navBarBtn = document.getElementById('navBarBtn');
        const navbarModal = UIkit.modal('#navbar-modal');
        const navbarForm = document.getElementById('navbar-form');
        const enableNavbar = document.getElementById('enable-navbar');
        const navbarBg = document.getElementById('navbar-bg');
        const navbarText = document.getElementById('navbar-text');
const navbarLogoUrl = document.getElementById('navbar-logo-url');
const navbarLogoUrlPreview = document.getElementById('navbar-logo-url-preview');
const navbarLogo = document.getElementById('navbar-logo');
const navbarLogoPreview = document.getElementById('navbar-logo-preview');
        const dynamicNavbarContainer = document.getElementById('dynamic-navbar-container');

        let currentMediaType = "image";
        let editingPrevFileName = '';
        let editingPrevFileData = '';
        let editingPrevFileType = '';
        let allSections = [];
        let toDeleteIndex = null;

        
function applyCustomCSS() {
  let styleEl = document.getElementById("custom-css-style");
  if (!styleEl) {
    styleEl = document.createElement("style");
    styleEl.id = "custom-css-style";
    document.head.appendChild(styleEl);
  }

  let css = siteSettings.customCSS || "";
  css += "\n" + generateFontCSS(); 
  styleEl.innerHTML = css;
}

        // Default settings
        let siteSettings = {
            language: 'en',
            title: 'CLASH Creator™',
            description: '',
            robots: 'index, follow',
            author: '',
            favicon: '',
            socialImage: '',
            appColor: '#000000',
            headScript: '',
            customCSS: '',
            fontName: '',
            applyFontBody: false,
            applyFontHeadings: false,
            navbar: { enabled: false, bg: '#ffffff', text: '#000000', logoUrl: '', logo: '', logoFileName: '' },
footer: {
  "enabled": false,
  "bg": "#222222",
  "text": "#ffffff",
  "phone": "",
  "email": "",
  "address": "",
  "android-robot": "",
  "apple": "",
  "behance": "",
  "discord": "",
  "dribbble": "",
  "etsy": "",
  "facebook": "",
  "flickr": "",
  "foursquare": "",
  "github": "",
  "google": "",
  "instagram": "",
  "joomla": "",
  "linkedin": "",
  "mastodon": "",
  "microsoft": "",
  "pinterest": "",
  "reddit": "",
  "signal": "",
  "soundcloud": "",
  "telegram": "",
  "threads": "",
  "tiktok": "",
  "tripadvisor": "",
  "tumblr": "",
  "twitch": "",
  "vimeo": "",
  "whatsapp": "",
  "wordpress": "",
  "x": "",
  "xing": "",
  "yelp": "",
  "youtube": "",
  "link": ""
}
        };

        function resetPrevFileBox() {
            prevFile.style.display = 'none';
            prevFileName.textContent = '';
            keepPrevFile.checked = true;
            editingPrevFileName = '';
            editingPrevFileData = '';
            editingPrevFileType = '';
        }

        function setupModal(type, data, idx) {
            currentMediaType = type;
            mediaModalTitle.textContent = type === 'image'
                ? (idx !== undefined ? 'Edit Image' : 'Add Image')
                : (idx !== undefined ? 'Edit Video' : 'Add Video');

// Toggle YouTube/Vimeo buttons
    const ytVimeoBlock = document.getElementById('youtube-vimeo-options');
    ytVimeoBlock.style.display = (type === 'video') ? '' : 'none';


            sectionIndex.value = idx !== undefined ? idx : '';
            if (data) {
                mediaUrl.value = data.url || '';
                mediaHeading.value = data.heading || '';
                mediaColor.value = data.headingColor || '#ffffff';
                bgColor.value = data.bgColor || '#000000';
                mediaSize.value = data.mediaSize || 'full';
                headingSize.value = data.headingSize || 'uk-heading-2xlarge';
                btnLabel.value = data.btnLabel || '';
                btnUrl.value = data.btnUrl || '';
                btnColor.value = data.btnColor || 'default';

                // new fields
                mediaSubtitle.value = data.subtitle || '';
                subtitleSize.value = data.subtitleSize || 'uk-heading-medium';
                subtitleColor.value = data.subtitleColor || '#ffffff';
                mediaParagraph.value = data.paragraph || '';
                paragraphSize.value = data.paragraphSize || 'large';
                paragraphColor.value = data.paragraphColor || '#ffffff';

                resetPrevFileBox();
                mediaFile.value = '';
                mediaFile.accept = type === 'image' ? 'image/*' : 'video/*';

                if (!data.url && data.fileName && data.fileData) {
                    editingPrevFileName = data.fileName;
                    editingPrevFileData = data.fileData;
                    editingPrevFileType = data.fileType;
                    prevFile.style.display = '';
                    prevFileName.textContent = data.fileName;
                } else {
                    resetPrevFileBox();
                }
            } else {
                mediaUrl.value = '';
                mediaHeading.value = 'Your Headline Here';
                mediaColor.value = '#ffffff';
                bgColor.value = '#000000';
                mediaSize.value = 'full';
                headingSize.value = 'uk-heading-large';
                btnLabel.value = '';
                btnUrl.value = '';
                btnColor.value = 'default';

                // new fields
                mediaSubtitle.value = '';
                subtitleSize.value = 'uk-heading-medium';
                subtitleColor.value = '#ffffff';
                mediaParagraph.value = '';
                paragraphSize.value = 'large';
                paragraphColor.value = '#ffffff';

                mediaFile.value = '';
                mediaFile.accept = type === 'image' ? 'image/*' : 'video/*';
                resetPrevFileBox();
            }
        }

        addImageBtn.addEventListener('click', () => {
            setupModal('image');
            mediaModal.show();
        });
        addVideoBtn.addEventListener('click', () => {
            setupModal('video');
            mediaModal.show();
        });

        function fileToDataURL(file, cb) {
            const reader = new FileReader();
            reader.onload = e => cb(e.target.result, file.name, file.type);
            reader.readAsDataURL(file);
        }

        function makeButtonHtml(label, url, color) {
            if (!label || !url) return '';
            let classes = {
                default: 'uk-button-default',
                primary: 'uk-button-primary',
                secondary: 'uk-button-secondary',
                text: 'uk-button-text'
            };
            return `<a href="${url}" class="uk-button ${classes[color] || 'uk-button-default'} uk-margin-top uk-border-rounded" target="_blank">${label}</a>`;
        }

        function getTextBlockHtml(block) {
            // Subtitle, then Paragraph
            let out = '';
            if (block.subtitle) {
                out += `<div class="live-subtitle ${block.subtitleSize || 'uk-heading-medium'}" style="color:${block.subtitleColor||'#fff'}">${block.subtitle}</div>`;
            }
            if (block.paragraph) {
                out += `<div class="live-paragraph${block.paragraphSize === 'large' ? ' large' : ''}" style="color:${block.paragraphColor||'#fff'};margin-top:0.5em;">${block.paragraph.replace(/\n/g, '<br>')}</div>`;
            }
            return out;
        }

// EMBED modal interactions
embedCodeBtn.addEventListener('click', () => {
    setupEmbedModal();
    UIkit.modal('#embed-modal').show(); // get a fresh modal instance
});

function setupEmbedModal(data, idx) {
    const titleEl = document.getElementById('embed-modal-title');
    titleEl.textContent = (idx !== undefined && idx !== null) ? 'Edit Embed Code' : 'Add Embed Code';
    embedCode.value = data ? data.code : '';
    document.getElementById("embed-bgcolor").value = data ? (data.bgColor || "#000000") : "#000000";
    embedIndex.value = (idx !== undefined && idx !== null) ? idx : '';
}

embedForm.addEventListener('submit', function (e) {
    e.preventDefault();
    let code = embedCode.value.trim();
    if (!code) {
        UIkit.notification({ message: 'Please enter some code.', status: 'warning' });
        return;
    }

    // Correctly parse index
    let idx = parseInt(embedIndex.value, 10);
    if (isNaN(idx)) idx = null;  // null means new section

let bgColorVal = document.getElementById("embed-bgcolor").value || "#000000";
let block = { type: 'embed', code, bgColor: bgColorVal };

    if (idx !== null) {
        allSections[idx] = block;   // update existing
    } else {
        allSections.push(block);    // add new
    }

    renderAllSections();
      applyFontLink();
      applyCustomCSS();
    embedModal.hide();
});


const settingsBtn = document.getElementById('settingsBtn');
const settingsModal = UIkit.modal('#settings-modal');
const settingsForm = document.getElementById('settings-form');

// Open modal
settingsBtn.addEventListener('click', () => {
    document.getElementById('site-language').value = siteSettings.language;
    document.getElementById('site-title').value = siteSettings.title;
    document.getElementById('site-description').value = siteSettings.description;
    document.getElementById('site-robots').value = siteSettings.robots;
    document.getElementById('site-author').value = siteSettings.author;
    document.getElementById('site-favicon').value = siteSettings.favicon;
    document.getElementById('site-social').value = siteSettings.socialImage;
    document.getElementById('site-head-script').value = siteSettings.headScript;
    document.getElementById("site-custom-css").value = siteSettings.customCSS;
    document.getElementById("site-font-name").value = siteSettings.fontName || "";
    document.getElementById("apply-to-body").checked = siteSettings.applyFontBody || false;
    document.getElementById("apply-to-headings").checked = siteSettings.applyFontHeadings || false;
    settingsModal.show();
});

// Save settings
settingsForm.addEventListener('submit', e => {
    e.preventDefault();
    siteSettings.language = document.getElementById('site-language').value;
    siteSettings.title = document.getElementById('site-title').value;
    siteSettings.description = document.getElementById('site-description').value;
    siteSettings.robots = document.getElementById('site-robots').value;
    siteSettings.author = document.getElementById('site-author').value;
    siteSettings.favicon = document.getElementById('site-favicon').value;
    siteSettings.socialImage = document.getElementById('site-social').value;
    siteSettings.headScript = document.getElementById('site-head-script').value;
    siteSettings.customCSS = document.getElementById("site-custom-css").value;

    siteSettings.fontName = document.getElementById("site-font-name").value.trim();

    const selectedTarget = document.querySelector('input[name="font-target"]:checked')?.value || 'none';
    siteSettings.fontTarget = selectedTarget;

    settingsModal.hide();
    applyFontLink(); 
    applyCustomCSS(); 
    updateDynamicNavbar();
    updateSiteTitleH1();
    updateFooter();
});

function getExportSectionHtml(block, exportMap) {
    if (block.type === 'text') {
        return `
        <div class="uk-section uk-section-muted uk-flex uk-flex-center uk-flex-middle"
             style="background:${block.bgColor}; min-height:60vh;">
          <div class="uk-container uk-text-center" style="color:${block.textColor || '#ffffff'};" uk-scrollspy="cls: ${block.animation}; repeat: true">
            ${block.heading ? `<h2 class="live-heading ${block.headingSize}" style="color:${block.textColor || '#ffffff'};">${block.heading}</h2>` : ''}
            ${block.subtitle ? `<div class="live-subtitle ${block.subtitleSize}" style="color:${block.textColor || '#ffffff'};">${block.subtitle}</div>` : ''}
            ${block.paragraph ? `<p class="live-paragraph ${block.paragraphSize}" style="color:${block.textColor || '#ffffff'};">${block.paragraph}</p>` : ''}
          </div>
        </div>`;
    }

if (block.type === 'embed') {
    return `
        <div style="position:relative; width:100%; height:100vh; margin:0; padding:0; background:${block.bgColor || '#000'};">
            <iframe srcdoc="${block.code.replace(/"/g, '&quot;')}" 
                    style="position:absolute; top:0; left:0; width:100%; height:100%; border:none; margin:0; padding:0; overflow:hidden;" 
                    sandbox="allow-scripts allow-same-origin allow-forms allow-popups">
            </iframe>
        </div>
    `;
}

    return getMediaSectionHtml(block, exportMap);
}


function getMediaSectionHtml(block, exportMap) {
    if (block.type === 'text') {
        return `
        <div class="uk-section uk-section-muted uk-flex uk-flex-center uk-flex-middle"
             style="background:${block.bgColor}; min-height:60vh;">
          <div class="uk-container uk-text-center" style="color:${block.textColor || '#ffffff'};" uk-scrollspy="cls: ${block.animation}; repeat: true">
            ${block.heading ? `<h2 class="live-heading ${block.headingSize}" style="color:${block.textColor || '#ffffff'};">${block.heading}</h2>` : ''}
            ${block.subtitle ? `<div class="live-subtitle ${block.subtitleSize}" style="color:${block.textColor || '#ffffff'};">${block.subtitle}</div>` : ''}
            ${block.paragraph ? `<p class="live-paragraph ${block.paragraphSize}" style="color:${block.textColor || '#ffffff'};">${block.paragraph}</p>` : ''}
          </div>
        </div>`;
    }

    let { type, src, url, heading, headingColor, headingSize, bgColor, mediaSize, btnLabel, btnUrl, btnColor, fileName } = block;
    let headingClass = `live-heading ${headingSize}`;
    let btnHtml = makeButtonHtml(btnLabel, btnUrl, btnColor);

    function refSrc(val, fileName, exportMap) {
        if (exportMap && fileName && exportMap[fileName]) {
            return 'media/' + exportMap[fileName];
        }
        return val;
    }

    const textBlock = `
        <div uk-scrollspy="cls: uk-animation-slide-top; repeat: true">
            <h2 class="${headingClass}" style="color: ${headingColor};">${heading || ''}</h2>
            ${getTextBlockHtml(block)}
            ${btnHtml}
        </div>
    `;

    // Decide animation for media
    let mediaSpy = '';
    if (mediaSize === 'left') mediaSpy = 'uk-scrollspy="cls: uk-animation-slide-right; repeat: true"';
    else if (mediaSize === 'right') mediaSpy = 'uk-scrollspy="cls: uk-animation-slide-left; repeat: true"';
    else if (mediaSize === 'center' || mediaSize === 'full') mediaSpy = 'uk-scrollspy="cls: uk-animation-slide-bottom; repeat: true"';

// EMBED: Full viewport
if (type === 'embed') {
    return `
        <div style="position:relative; width:100%; height:100vh; margin:0; padding:0; background:${block.bgColor || '#000'};">
            <iframe srcdoc="${block.code.replace(/"/g, '&quot;')}" 
                    style="position:absolute; top:0; left:0; width:100%; height:100%; border:none; margin:0; padding:0; overflow:hidden;" 
                    sandbox="allow-scripts allow-same-origin allow-forms allow-popups">
            </iframe>
        </div>
    `;
}
    // IMAGE
    if (type === 'image') {
        // FULL (image centered, responsive)
        if (mediaSize === 'full') {
            return `
<div style="position:relative; width:100vw; height:100vh; overflow:hidden; background:${bgColor};">
    <img src="${refSrc(src, fileName, exportMap)}"
         alt="Image"
         style="width:100vw; height:100vh; object-fit:cover; display:block;" 
         ${mediaSpy}>
    <div style="position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); width:100%;" 
         class="uk-text-center uk-light">
        ${textBlock}
    </div>
</div>
            `;
        }

        // CENTER (small centered media with text below)
        if (mediaSize === 'center') {
            return `
                <div class="uk-padding-large" style="background:${bgColor};">
                    <div class="uk-flex uk-flex-center uk-flex-middle uk-flex-wrap">
                        <div class="uk-text-center">
                            <img src="${refSrc(src, fileName, exportMap)}"
                                 alt="Image"
                                 class="uk-border-rounded uk-box-shadow-large"
                                 style="max-width:620px; width:100%; height:auto; display:block; margin:0 auto;"
                                 ${mediaSpy}>
                            ${textBlock}
                        </div>
                    </div>
                </div>
            `;
        }

        // LEFT (image left, text right)
        if (mediaSize === 'left') {
            return `
                <div class="uk-padding-large" style="background:${bgColor};">
                    <div class="uk-grid uk-grid-medium uk-flex-middle" uk-grid>
                        <div class="uk-width-1-2@m">
                            <img src="${refSrc(src, fileName, exportMap)}"
                                 alt="Image"
                                 class="uk-border-rounded uk-box-shadow-large"
                                 style="max-width:100%; width:100%; height:auto; display:block;"
                                 ${mediaSpy}>
                        </div>
                        <div class="uk-width-expand@m uk-padding-small">
                            ${textBlock}
                        </div>
                    </div>
                </div>
            `;
        }

// RIGHT (image right on desktop, text left; image above text on mobile)
if (mediaSize === 'right') {
    return `
        <div class="uk-padding-large" style="background:${bgColor};">
            <div class="uk-grid uk-grid-medium uk-flex-middle" uk-grid>
                <div class="uk-width-1-2@m uk-flex-last@m">
                    <img src="${refSrc(src, fileName, exportMap)}"
                         alt="Image"
                         class="uk-border-rounded uk-box-shadow-large"
                         style="max-width:100%; width:100%; height:auto; display:block;"
                         ${mediaSpy}>
                </div>
                <div class="uk-width-expand@m uk-padding-small">
                    ${textBlock}
                </div>
            </div>
        </div>
    `;
}

        // fallback (treat as left)
        return `
            <div class="uk-padding-large" style="background:${bgColor};">
                <div class="uk-grid uk-grid-medium uk-flex-middle" uk-grid>
                    <div class="uk-width-1-2@m">
                        <img src="${refSrc(src, fileName, exportMap)}"
                             alt="Image"
                             class="uk-border-rounded uk-box-shadow-large"
                             style="max-width:100%; width:100%; height:auto; display:block;"
                             ${mediaSpy}>
                    </div>
                    <div class="uk-width-expand@m uk-padding-small">
                        ${textBlock}
                    </div>
                </div>
            </div>
        `;
    }



    // VIDEO
    if (type === 'video') {
        // FULL (cover video background, text overlay)
        if (mediaSize === 'full') {
            return `
                <div style="position:relative; width:100vw; height:100vh; overflow:hidden;">
                    <video src="${refSrc(src, fileName, exportMap)}" autoplay loop muted playsinline
                        style="width:100vw;height:100vh;object-fit:cover;display:block;" ${mediaSpy}></video>
                    <div style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:100%;" class="uk-text-center uk-light">
                        ${textBlock}
                    </div>
                </div>
            `;
        }

        // CENTER (small centered video with text below)
        if (mediaSize === 'center') {
            return `
                <div class="uk-padding-large" style="background:${bgColor};">
                    <div class="uk-flex uk-flex-center uk-flex-middle uk-flex-wrap">
                        <div class="uk-text-center">
                            <video src="${refSrc(src, fileName, exportMap)}" autoplay loop muted playsinline
                                   class="uk-border-rounded uk-box-shadow-large"
                                   style="max-width:620px; width:100%; height:auto; display:block; margin:0 auto;"
                                   ${mediaSpy}></video>
                            ${textBlock}
                        </div>
                    </div>
                </div>
            `;
        }

        // LEFT (video left, text right)
        if (mediaSize === 'left') {
            return `
                <div class="uk-padding-large" style="background:${bgColor};">
                    <div class="uk-grid uk-grid-medium uk-flex-middle" uk-grid>
                        <div class="uk-width-1-2@m">
                            <video src="${refSrc(src, fileName, exportMap)}" autoplay loop muted playsinline
                                class="uk-border-rounded uk-box-shadow-large"
                                style="max-width:100%; width:100%; height:auto; display:block;" ${mediaSpy}></video>
                        </div>
                        <div class="uk-width-expand@m uk-padding-small">
                            ${textBlock}
                        </div>
                    </div>
                </div>
            `;
        }

        // RIGHT (video right, text left)
        if (mediaSize === 'right') {
            return `
                <div class="uk-padding-large" style="background:${bgColor};">
                    <div class="uk-grid uk-grid-medium uk-flex-middle" uk-grid>
                        <div class="uk-width-expand@m uk-padding-small uk-text-right">
                            ${textBlock}
                        </div>
                        <div class="uk-width-1-2@m">
                            <video src="${refSrc(src, fileName, exportMap)}" autoplay loop muted playsinline
                                class="uk-border-rounded uk-box-shadow-large"
                                style="max-width:100%; width:100%; height:auto;" ${mediaSpy}></video>
                        </div>
                    </div>
                </div>
            `;
        }

        // fallback
        return `
            <div class="uk-padding-large" style="background:${bgColor};">
                <div class="uk-grid uk-grid-medium uk-flex-middle" uk-grid>
                    <div class="uk-width-1-2@m">
                        <video src="${refSrc(src, fileName, exportMap)}" autoplay loop muted playsinline
                            class="uk-border-rounded uk-box-shadow-large"
                            style="max-width:100%; width:100%; height:auto;" ${mediaSpy}></video>
                    </div>
                    <div class="uk-width-expand@m uk-padding-small">
                        ${textBlock}
                    </div>
                </div>
            </div>
        `;
    }

    // default fallback (if unknown type)
    return `<div class="uk-padding-large" style="background:${bgColor};">${textBlock}</div>`;
}

        // --- RENDER ---
        function renderAllSections() {
            editorRoot.innerHTML = '';
            allSections.forEach((block, idx) => {
                const li = document.createElement('li');
                li.dataset.id = block.id;
                li.className = 'editor-section uk-padding-remove uk-sortable-handle';
                li.style.position = 'relative';
                const removeBtn = `<button class="uk-button uk-button-danger uk-border-rounded editor-remove-btn" type="button" uk-icon="trash" uk-tooltip="Remove section"></button>`;
                const editBtn = `<button class="uk-icon-button uk-button-primary uk-border-rounded editor-edit-btn" type="button" uk-icon="pencil" uk-tooltip="Edit section"></button>`;
                const sectionStyle = `background: ${block.bgColor}; min-height:60vh;`;

                li.innerHTML = `
                    <section id="section-${idx}" class="uk-section uk-section-primary" uk-height-viewport="offset-top: true" style="${sectionStyle};">
                        ${editBtn}
                        ${removeBtn}
                        ${getMediaSectionHtml(block)}
                    </section>
                `;
                // --- Remove button always shows modal ---
                li.querySelector('.editor-remove-btn').addEventListener('click', function() {
                    toDeleteIndex = idx;
                    deleteModal.show();
                });
                // --- Edit ---
                li.querySelector('.editor-edit-btn').addEventListener('click', function () {
    if (block.type === 'embed') {
        setupEmbedModal(block, idx);
        UIkit.modal('#embed-modal').show();
    } else if (block.type === 'text') {
        // Prefill text modal with saved values
        textHeading.value   = block.heading || '';
        textSubtitle.value  = block.subtitle || '';
        textParagraph.value = block.paragraph || '';
        textAnimation.value = block.animation || 'uk-animation-fade';
        if (typeof textBgColor !== 'undefined') textBgColor.value = block.bgColor || '#000000';
        if (typeof textColor !== 'undefined')   textColor.value   = block.textColor || '#ffffff';
        if (typeof textHeadingSize !== 'undefined')  textHeadingSize.value  = block.headingSize || 'h-lg';
        if (typeof textSubtitleSize !== 'undefined') textSubtitleSize.value = block.subtitleSize || 'sub-md';
        if (typeof textParagraphSize !== 'undefined') textParagraphSize.value = block.paragraphSize || 'p-md';
        textIndex.value = idx;
        textModal.show();
    } else {
        setupModal(block.type, block, idx);
        mediaModal.show();
    }
});

                editorRoot.appendChild(li);
            });
            UIkit.update(editorRoot);
            updateDynamicNavbar();
  updateSiteTitleH1();
  updateFooter();
        }

        // Confirm Delete modal
        confirmDeleteBtn.addEventListener('click', function() {
            if (toDeleteIndex !== null && allSections[toDeleteIndex]) {
                allSections.splice(toDeleteIndex, 1);
                renderAllSections();
      applyFontLink();
      applyCustomCSS();
                toDeleteIndex = null;
                deleteModal.hide();
            }
        });

        // Sortable event
UIkit.util.on(editorRoot, 'moved', function(e) {
    let newSections = [];
    Array.from(editorRoot.children).forEach(li => {
        let id = li.dataset.id;                      // use stable id
        let found = allSections.find(b => b.id === id);
        if (found) newSections.push(found);
    });
    if (newSections.length === allSections.length) {
        allSections = newSections;
    }
    renderAllSections();
      applyFontLink();
      applyCustomCSS(); // re-render to update section-ids and dynamic navbar
});

        // Modal submission
        mediaForm.addEventListener('submit', function(e) {
            e.preventDefault();
            let file = mediaFile.files[0];
            let url = mediaUrl.value.trim();
            let heading = mediaHeading.value || '';
            let headingColor = mediaColor.value || '#ffffff';
            let headingSizeVal = headingSize.value || 'uk-heading-2xlarge';
            let mediaSizeVal = mediaSize.value;
            let bgColorVal = bgColor.value || "#000000";
            let btnLabelVal = btnLabel.value.trim();
            let btnUrlVal = btnUrl.value.trim();
            let btnColorVal = btnColor.value;
            // New
            let subtitleVal = mediaSubtitle.value || '';
            let subtitleSizeVal = subtitleSize.value || 'uk-heading-medium';
            let subtitleColorVal = subtitleColor.value || '#ffffff';
            let paragraphVal = mediaParagraph.value || '';
            let paragraphSizeVal = paragraphSize.value || '';
            let paragraphColorVal = paragraphColor.value || '#ffffff';

            let idx = sectionIndex.value ? parseInt(sectionIndex.value) : null;

function generateId() {
    return 'sec-' + Math.random().toString(36).substr(2, 9);
}

function finishSection(src, fileData, fileName, fileType) {
    let block = {
        id: (idx !== null && allSections[idx]) ? allSections[idx].id : generateId(), // keep old id if editing
        type: currentMediaType,
        src,
        url: url ? url : '',
        heading,
        headingColor,
        headingSize: headingSizeVal,
        bgColor: bgColorVal,
        mediaSize: mediaSizeVal,
        btnLabel: btnLabelVal,
        btnUrl: btnUrlVal,
        btnColor: btnColorVal,
        subtitle: subtitleVal,
        subtitleSize: subtitleSizeVal,
        subtitleColor: subtitleColorVal,
        paragraph: paragraphVal,
        paragraphSize: paragraphSizeVal,
        paragraphColor: paragraphColorVal
    };
                // Always set fileData and fileName if uploading
                if (!url && fileData && fileName) {
                    block.fileData = fileData;
                    block.fileName = fileName;
                    block.fileType = fileType;
                }
                if (idx !== null && !isNaN(idx)) {
                    allSections[idx] = block;
                } else {
                    allSections.push(block);
                }
                renderAllSections();
      applyFontLink();
      applyCustomCSS();
                mediaModal.hide();
            }

            if (file) {
                fileToDataURL(file, (dataurl, fileName, fileType) => finishSection(dataurl, dataurl, fileName, fileType));
            } else if (url) {
                finishSection(url);
            } else if (prevFile.style.display !== 'none' && keepPrevFile.checked && editingPrevFileData) {
                finishSection(editingPrevFileData, editingPrevFileData, editingPrevFileName, editingPrevFileType);
            } else {
                UIkit.notification({message: 'Please provide a URL or upload a file.', status: 'warning'});
                return;
            }
        });

// Save as JSON (wrap settings + sections, including logo/fav/social as base64 backup)
saveJSONBtn.addEventListener('click', function() {
    // Work on a shallow copy so we don’t mutate the live siteSettings
    const settingsToSave = JSON.parse(JSON.stringify(siteSettings));

    // Remove Blob references (they are not serializable)
    delete settingsToSave.faviconBlob;
    delete settingsToSave.socialBlob;
    if (settingsToSave.navbar) {
        delete settingsToSave.navbar.logoBlob;
    }

    // Helper to convert Blob → base64
    const convertBlobToBase64 = (blob) => new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => resolve(reader.result);
        reader.onerror = reject;
        reader.readAsDataURL(blob);
    });

    const conversions = [];

    // Save logo as base64 if available
    if (siteSettings.navbar && siteSettings.navbar.logoBlob) {
        conversions.push(convertBlobToBase64(siteSettings.navbar.logoBlob).then(b64 => {
            settingsToSave.navbar.logoBase64 = b64;
        }));
    }

    // Save favicon as base64 if available
    if (siteSettings.faviconBlob) {
        conversions.push(convertBlobToBase64(siteSettings.faviconBlob).then(b64 => {
            settingsToSave.faviconBase64 = b64;
        }));
    }

    // Save social image as base64 if available
    if (siteSettings.socialBlob) {
        conversions.push(convertBlobToBase64(siteSettings.socialBlob).then(b64 => {
            settingsToSave.socialBase64 = b64;
        }));
    }

    // Once all conversions are done, generate JSON
    Promise.all(conversions).then(() => {
        const out = JSON.stringify({ settings: settingsToSave, sections: allSections }, null, 2);
        const blob = new Blob([out], { type: "application/json" });
        const url = URL.createObjectURL(blob);

        const a = document.createElement('a');
        a.href = url;
        let fileName = prompt("Enter a name for your JSON file:", "homepage.json");
        if (!fileName) fileName = "homepage.json"; // fallback
        a.download = fileName.endsWith(".json") ? fileName : fileName + ".json";

        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    });
});

/// Load JSON (unwrap settings + sections)
loadJSONBtn.addEventListener('click', function() {
    jsonFileInput.click();
});

jsonFileInput.addEventListener('change', function(e) {
    if (!e.target.files[0]) return;
    const file = e.target.files[0];
    const reader = new FileReader();
    reader.onload = function(evt) {
        try {
            const data = JSON.parse(evt.target.result || '{}');

            // If file only had sections (old format), fallback gracefully
if (Array.isArray(data)) {
    allSections = data;
} else {
    siteSettings = data.settings || siteSettings;
    siteSettings.navbar = Object.assign(
        { enabled:false, bg:'#ffffff', text:'#000000', logoUrl:'', logoFileName:'' },
        siteSettings.navbar || {}
    );
    allSections = data.sections || [];

    // Restore font settings if present
    siteSettings.fontName = data.settings?.fontName || siteSettings.fontName || '';
    siteSettings.fontTarget = data.settings?.fontTarget || siteSettings.fontTarget || 'none';

    // Sync the radio button in Site Settings modal
    if (siteSettings.fontTarget) {
        const radio = document.querySelector(`input[name="font-target"][value="${siteSettings.fontTarget}"]`);
        if (radio) radio.checked = true;
    }
}

renderAllSections();

            // Reapply Google Fonts + custom CSS
            applyFontLink();
            applyCustomCSS();

            // ---  Sync textarea in Site Settings modal
            const cssField = document.getElementById("site-custom-css");
            if (cssField) cssField.value = siteSettings.customCSS || "";

            // --- Restore logo, favicon, and social from JSON (base64 backup first, fallback to export paths) ---
            if (siteSettings.faviconBase64) {
                siteSettings.faviconBlob = dataURLtoBlob(siteSettings.faviconBase64);
                faviconPreview.innerHTML = `<img src="${siteSettings.faviconBase64}" style="max-height:40px;">`;
            } else if (siteSettings.faviconExport) {
                faviconPreview.innerHTML = `<img src="${siteSettings.faviconExport}" style="max-height:40px;">`;
            } else {
                faviconPreview.innerHTML = '';
            }

            if (siteSettings.socialBase64) {
                siteSettings.socialBlob = dataURLtoBlob(siteSettings.socialBase64);
                socialPreview.innerHTML = `<img src="${siteSettings.socialBase64}" style="max-height:80px;">`;
            } else if (siteSettings.socialExport) {
                socialPreview.innerHTML = `<img src="${siteSettings.socialExport}" style="max-height:80px;">`;
            } else {
                socialPreview.innerHTML = '';
            }

            if (siteSettings.navbar && siteSettings.navbar.logoBase64) {
                siteSettings.navbar.logo = siteSettings.navbar.logoBase64;   
                siteSettings.navbar.logoBlob = dataURLtoBlob(siteSettings.navbar.logoBase64);
                navbarLogoPreview.innerHTML = `<img src="${siteSettings.navbar.logoBase64}" class="navbar-logo">`;
            } else if (siteSettings.navbar.logoExport) {
                navbarLogoPreview.innerHTML = `<img src="${siteSettings.navbar.logoExport}" class="navbar-logo">`;
            } else {
                navbarLogoPreview.innerHTML = '';
            }

            // Utility: Convert base64 back to Blob
            function dataURLtoBlob(dataurl) {
                let arr = dataurl.split(',');
                let mime = arr[0].match(/:(.*?);/)[1];
                let bstr = atob(arr[1]);
                let n = bstr.length;
                let u8arr = new Uint8Array(n);
                let nLen = bstr.length;
                while (nLen--) {
                    u8arr[nLen] = bstr.charCodeAt(nLen);
                }
                return new Blob([u8arr], { type: mime });
            }

        } catch {
            UIkit.notification({message: 'Invalid JSON file!', status:'danger'});
        }
    };
    reader.readAsText(file);
    e.target.value = '';
});

// --- Footer Modal Controls ---
const footerBtn = document.getElementById('footerBtn');
const footerModal = UIkit.modal('#footer-modal');
const footerForm = document.getElementById('footer-form');
const enableFooter = document.getElementById('enable-footer');
const footerBg = document.getElementById('footer-bg');
const footerText = document.getElementById('footer-text');
const footerPhone = document.getElementById('footer-phone');
const footerEmail = document.getElementById('footer-email');
const footerAddress = document.getElementById('footer-address');

footerBtn.addEventListener('click', () => {
  enableFooter.checked = siteSettings.footer.enabled;
  footerBg.value = siteSettings.footer.bg;
  footerText.value = siteSettings.footer.text;
  footerPhone.value = siteSettings.footer.phone || '';
  footerEmail.value = siteSettings.footer.email || '';
  footerAddress.value = siteSettings.footer.address || '';
  footerModal.show();
});

footerForm.addEventListener('submit', (e) => {
  e.preventDefault();
  siteSettings.footer.enabled = enableFooter.checked;
  siteSettings.footer.bg = footerBg.value;
  siteSettings.footer.text = footerText.value;
  siteSettings.footer.phone = footerPhone.value.trim();
  siteSettings.footer.email = footerEmail.value.trim();
  siteSettings.footer.address = footerAddress.value.trim();
siteSettings.footer["android-robot"] = document.getElementById("footer-android-robot").value.trim();
siteSettings.footer["apple"] = document.getElementById("footer-apple").value.trim();
siteSettings.footer["behance"] = document.getElementById("footer-behance").value.trim();
siteSettings.footer["discord"] = document.getElementById("footer-discord").value.trim();
siteSettings.footer["dribbble"] = document.getElementById("footer-dribbble").value.trim();
siteSettings.footer["etsy"] = document.getElementById("footer-etsy").value.trim();
siteSettings.footer["facebook"] = document.getElementById("footer-facebook").value.trim();
siteSettings.footer["flickr"] = document.getElementById("footer-flickr").value.trim();
siteSettings.footer["foursquare"] = document.getElementById("footer-foursquare").value.trim();
siteSettings.footer["github"] = document.getElementById("footer-github").value.trim();
siteSettings.footer["google"] = document.getElementById("footer-google").value.trim();
siteSettings.footer["instagram"] = document.getElementById("footer-instagram").value.trim();
siteSettings.footer["joomla"] = document.getElementById("footer-joomla").value.trim();
siteSettings.footer["linkedin"] = document.getElementById("footer-linkedin").value.trim();
siteSettings.footer["mastodon"] = document.getElementById("footer-mastodon").value.trim();
siteSettings.footer["microsoft"] = document.getElementById("footer-microsoft").value.trim();
siteSettings.footer["pinterest"] = document.getElementById("footer-pinterest").value.trim();
siteSettings.footer["reddit"] = document.getElementById("footer-reddit").value.trim();
siteSettings.footer["signal"] = document.getElementById("footer-signal").value.trim();
siteSettings.footer["soundcloud"] = document.getElementById("footer-soundcloud").value.trim();
siteSettings.footer["telegram"] = document.getElementById("footer-telegram").value.trim();
siteSettings.footer["threads"] = document.getElementById("footer-threads").value.trim();
siteSettings.footer["tiktok"] = document.getElementById("footer-tiktok").value.trim();
siteSettings.footer["tripadvisor"] = document.getElementById("footer-tripadvisor").value.trim();
siteSettings.footer["tumblr"] = document.getElementById("footer-tumblr").value.trim();
siteSettings.footer["twitch"] = document.getElementById("footer-twitch").value.trim();
siteSettings.footer["vimeo"] = document.getElementById("footer-vimeo").value.trim();
siteSettings.footer["whatsapp"] = document.getElementById("footer-whatsapp").value.trim();
siteSettings.footer["wordpress"] = document.getElementById("footer-wordpress").value.trim();
siteSettings.footer["x"] = document.getElementById("footer-x").value.trim();
siteSettings.footer["xing"] = document.getElementById("footer-xing").value.trim();
siteSettings.footer["yelp"] = document.getElementById("footer-yelp").value.trim();
siteSettings.footer["youtube"] = document.getElementById("footer-youtube").value.trim();
siteSettings.footer["link"] = document.getElementById("footer-link").value.trim();

  footerModal.hide();
  updateFooter();
});


function buildSocialIcons() {
 const socials = [
  { key: 'android-robot', icon: 'android-robot' },
  { key: 'apple', icon: 'apple' },
  { key: 'behance', icon: 'behance' },
  { key: 'discord', icon: 'discord' },
  { key: 'dribbble', icon: 'dribbble' },
  { key: 'etsy', icon: 'etsy' },
  { key: 'facebook', icon: 'facebook' },
  { key: 'flickr', icon: 'flickr' },
  { key: 'foursquare', icon: 'foursquare' },
  { key: 'github', icon: 'github' },
  { key: 'google', icon: 'google' },
  { key: 'instagram', icon: 'instagram' },
  { key: 'joomla', icon: 'joomla' },
  { key: 'linkedin', icon: 'linkedin' },
  { key: 'mastodon', icon: 'mastodon' },
  { key: 'microsoft', icon: 'microsoft' },
  { key: 'pinterest', icon: 'pinterest' },
  { key: 'reddit', icon: 'reddit' },
  { key: 'signal', icon: 'signal' },
  { key: 'soundcloud', icon: 'soundcloud' },
  { key: 'telegram', icon: 'telegram' },
  { key: 'threads', icon: 'threads' },
  { key: 'tiktok', icon: 'tiktok' },
  { key: 'tripadvisor', icon: 'tripadvisor' },
  { key: 'tumblr', icon: 'tumblr' },
  { key: 'twitch', icon: 'twitch' },
  { key: 'vimeo', icon: 'vimeo' },
  { key: 'whatsapp', icon: 'whatsapp' },
  { key: 'wordpress', icon: 'wordpress' },
  { key: 'x', icon: 'x' },           // Twitter/X
  { key: 'xing', icon: 'xing' },
  { key: 'yelp', icon: 'yelp' },
  { key: 'youtube', icon: 'youtube' },
  { key: 'link', icon: 'link' }
  ];
  let html = socials
    .filter(s => siteSettings.footer[s.key])
    .map(s =>
      `<a href="${siteSettings.footer[s.key]}" uk-icon="${s.icon}" target="_blank" style="margin:0 8px; color:${siteSettings.footer.text}"></a>`
    ).join('');
  return html ? `<div class="footer-social" style="margin-bottom:10px;">${html}</div>` : '';
}

function buildFooterHtml() {
  if (!siteSettings.footer.enabled) return '';
  let content = siteSettings.footer.content && siteSettings.footer.content.trim()
    ? siteSettings.footer.content
    : `&copy; ${new Date().getFullYear()} ${siteSettings.title || 'My Website'}`;
  let contactHtml = '';
  if (siteSettings.footer.phone) {
    contactHtml += `<div><span uk-icon="receiver"></span> <a href="tel:${siteSettings.footer.phone}" style="color:${siteSettings.footer.text}">${siteSettings.footer.phone}</a></div>`;
  }
  if (siteSettings.footer.email) {
    contactHtml += `<div><span uk-icon="mail"></span> <a href="mailto:${siteSettings.footer.email}" style="color:${siteSettings.footer.text}">${siteSettings.footer.email}</a></div>`;
  }
  if (siteSettings.footer.address) {
    contactHtml += `<div><span uk-icon="location"></span> ${siteSettings.footer.address}</div>`;
  }

return `
  <footer class="uk-section uk-section-small" 
          style="background:${siteSettings.footer.bg}; color:${siteSettings.footer.text}; text-align:center;">
    ${buildSocialIcons()}
      <p><strong>${siteSettings.title || ''}</strong></p>
    ${contactHtml}
    <p>&copy; ${new Date().getFullYear()} ${siteSettings.author || ''}</p>
  </footer>`;
}

function updateFooter() {
  const existing = document.getElementById('editor-footer');
  if (existing) existing.remove();
  if (siteSettings.footer.enabled) {
    const footer = document.createElement('div');
    footer.id = 'editor-footer';
    footer.innerHTML = buildFooterHtml();
    document.body.appendChild(footer);
  }
}


// --- Favicon & Social Upload ---
const faviconFile = document.getElementById('site-favicon-file');
const faviconPreview = document.getElementById('site-favicon-preview');
const socialFile = document.getElementById('site-social-file');
const socialPreview = document.getElementById('site-social-preview');

faviconFile.addEventListener('change', (e) => {
  if (e.target.files[0]) {
    const file = e.target.files[0];
    siteSettings.faviconBlob = file;   // ✅ store blob
    siteSettings.faviconFileName = file.name;
    siteSettings.faviconFileType = file.type;
    siteSettings.favicon = '';         // clear legacy base64
    faviconPreview.innerHTML = `<img src="${URL.createObjectURL(file)}" style="max-height:40px;">`;
  }
});

socialFile.addEventListener('change', (e) => {
  if (e.target.files[0]) {
    const file = e.target.files[0];
    siteSettings.socialBlob = file;   // ✅ store blob
    siteSettings.socialFileName = file.name;
    siteSettings.socialFileType = file.type;
    siteSettings.socialImage = '';    // clear legacy base64
    socialPreview.innerHTML = `<img src="${URL.createObjectURL(file)}" style="max-height:80px;">`;
  }
});

// NEW: Navbar modal open/save

navBarBtn.addEventListener('click', () => {
  enableNavbar.checked = siteSettings.navbar.enabled;
  navbarBg.value = siteSettings.navbar.bg;
  navbarText.value = siteSettings.navbar.text;
  navbarLogoUrl.value = siteSettings.navbar.logoUrl || '';
  if (siteSettings.navbar.logoUrl) {
    navbarLogoUrlPreview.innerHTML = `<img src="${siteSettings.navbar.logoUrl}" class="navbar-logo">`;
  } else {
    navbarLogoUrlPreview.innerHTML = '';
  }
if (siteSettings.navbar.logoBlob) {
  navbarLogoPreview.innerHTML = `<img src="${URL.createObjectURL(siteSettings.navbar.logoBlob)}" class="navbar-logo">`;
} else if (siteSettings.navbar.logoUrl) {
  navbarLogoPreview.innerHTML = `<img src="${siteSettings.navbar.logoUrl}" class="navbar-logo">`;
} else {
  navbarLogoPreview.innerHTML = '';
}
  navbarModal.show();
});

navbarLogoUrl.addEventListener('input', () => {
  const url = navbarLogoUrl.value.trim();
  if (url) {
    navbarLogoUrlPreview.innerHTML = `<img src="${url}" class="navbar-logo">`;
  } else {
    navbarLogoUrlPreview.innerHTML = '';
  }
});

navbarLogo.addEventListener('change', (e) => {
  if (e.target.files[0]) {
    const file = e.target.files[0];
    siteSettings.navbar.logoFileName = file.name;
    siteSettings.navbar.logoBlob = file;   // blob, not base64
    siteSettings.navbar.logo = '';         // clear legacy base64
    navbarLogoPreview.innerHTML = `<img src="${URL.createObjectURL(file)}" class="navbar-logo">`;
  }
});

navbarForm.addEventListener('submit', (e) => {
  e.preventDefault();
  siteSettings.navbar.enabled = enableNavbar.checked;
  siteSettings.navbar.bg = navbarBg.value;
  siteSettings.navbar.text = navbarText.value;
  navbarModal.hide();
  updateDynamicNavbar();
  updateSiteTitleH1();
  updateFooter();
});

// Build dynamic navbar HTML for the EDITOR page (second navbar under toolbar)
function buildEditorDynamicNavBarHtml() {
  if (!siteSettings.navbar.enabled) return '';
  const links = [];
  
if (siteSettings.navbar.logoUrl) {
    links.push(`<li><a href="#top"><img src="${siteSettings.navbar.logoUrl}" alt="${siteSettings.title}" class="navbar-logo"></a></li>`);
} else if (siteSettings.navbar.logoBase64) {
    links.push(`<li><a href="#top"><img src="${siteSettings.navbar.logoBase64}" alt="${siteSettings.title}" class="navbar-logo"></a></li>`);
} else if (siteSettings.navbar.logoBlob) {
    links.push(`<li><a href="#top"><img src="${URL.createObjectURL(siteSettings.navbar.logoBlob)}" alt="${siteSettings.title}" class="navbar-logo"></a></li>`);
} else {
    links.push(`<li><a href="#top">${siteSettings.title || 'Home'}</a></li>`);
}

  allSections.forEach((block, idx) => {
    if (block.heading) {
      const safe = String(block.heading).replace(/</g, '&lt;').replace(/>/g, '&gt;');
      links.push(`<li><a href="#section-${idx}">${safe}</a></li>`);
    }
  });
  // place below toolbar; sticky will naturally sit under it since toolbar also sticky
  return `<nav class="uk-navbar-container" style="background:${siteSettings.navbar.bg};position:sticky;top:60px;z-index:999;">
    <ul class="navbar-scroll" uk-scrollspy-nav="closest: a; scroll: true; offset: 100" style="color:${siteSettings.navbar.text};">
      ${links.join('')}
    </ul>
  </nav>`;
}

// Toggle H1 visibility depending on logo presence
const siteTitleH1 = document.getElementById('site-title-h1');
function updateSiteTitleH1() {
  siteTitleH1.textContent = siteSettings.title || '';
  if (siteSettings.navbar.logoUrl || siteSettings.navbar.logoBase64 || siteSettings.navbar.logoBlob) {
    siteTitleH1.classList.add('visually-hidden');
  } else {
    siteTitleH1.classList.remove('visually-hidden');
  }
}

// Update/inject the dynamic navbar in the editor

function updateDynamicNavbar() {
  if (!dynamicNavbarContainer) return;
  dynamicNavbarContainer.innerHTML = buildEditorDynamicNavBarHtml();
}

// Recompute offset on resize (simple re-render)
window.addEventListener('resize', updateDynamicNavbar);


const previewBtn = document.getElementById('previewBtn');

// Helper: build dynamic navbar for PREVIEW/EXPORT (top:0 since no toolbar)
function buildPreviewDynamicNavBarHtml() {
  if (!siteSettings.navbar.enabled) return '';
  const links = [];

if (siteSettings.navbar.logoExport) {
  // 1. Exported file path (set during Export)
  links.push(`<li><a href="#top"><img src="${siteSettings.navbar.logoExport}" alt="${siteSettings.title}" class="navbar-logo"></a></li>`);
} else if (siteSettings.navbar.logoUrl) {
  // 2. Explicit URL
  links.push(`<li><a href="#top"><img src="${siteSettings.navbar.logoUrl}" alt="${siteSettings.title}" class="navbar-logo"></a></li>`);
} else if (siteSettings.navbar.logoBase64) {
  // 3. Base64 restored from JSON
  links.push(`<li><a href="#top"><img src="${siteSettings.navbar.logoBase64}" alt="${siteSettings.title}" class="navbar-logo"></a></li>`);
} else if (siteSettings.navbar.logoBlob) {
  // 4. Uploaded file not yet exported
  const blobUrl = URL.createObjectURL(siteSettings.navbar.logoBlob);
  links.push(`<li><a href="#top"><img src="${blobUrl}" alt="${siteSettings.title}" class="navbar-logo"></a></li>`);
} else {
  // 5. Fallback: just show the site title
  links.push(`<li><a href="#top">${siteSettings.title || 'Home'}</a></li>`);
}

  allSections.forEach((block, idx) => {
    if (block.heading) {
      const safe = String(block.heading).replace(/</g, '&lt;').replace(/>/g, '&gt;');
      links.push(`<li><a href="#section-${idx}">${safe}</a></li>`);
    }
  });

  return `<nav class="uk-navbar-container" style="background:${siteSettings.navbar.bg};position:sticky;top:0;z-index:999;">
    <ul class="navbar-scroll" uk-scrollspy-nav="closest: a; scroll: true; offset: 100" style="color:${siteSettings.navbar.text};">
      ${links.join('')}
    </ul>
  </nav>`;
}

// Preview in new window
previewBtn.addEventListener('click', function () {
    const exportMap = {}; // not needed for preview, but avoids errors

let exportBlocks = allSections.map((block, idx) =>
    `<section id="section-${idx}" class="uk-section uk-section-primary" uk-height-viewport="offset-top: true" style="background:${block.bgColor};min-height:60vh;padding:0;margin:0;">
        ${getExportSectionHtml(block, exportMap)}
    </section>`
).join('\n');

    let navBarHtml = buildPreviewDynamicNavBarHtml();

let html = `
<!DOCTYPE html>
<html lang="${siteSettings.language}">
<head>
  <meta charset="UTF-8">
  <title>${siteSettings.title}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="${siteSettings.description}">
  <meta name="robots" content="${siteSettings.robots}">
  <meta name="author" content="${siteSettings.author}">
`;

// Inject Google Font link & CSS if set
if (siteSettings.fontName) {
  const fontUrl = `https://fonts.googleapis.com/css2?family=${siteSettings.fontName.replace(/ /g,'+')}&display=swap`;
  html += `<link href="${fontUrl}" rel="stylesheet">\n`;
  html += `<style>\n${generateFontCSS()}\n</style>\n`;
}

// Continue head content
html += `
  ${siteSettings.faviconExport ? `<link rel="icon" href="${siteSettings.faviconExport}">\n  <link rel="shortcut icon" href="${siteSettings.faviconExport}">` : ''}
  ${siteSettings.socialExport ? `<meta property="og:image" content="${siteSettings.socialExport}">` : ''}
  ${siteSettings.headScript || ''}
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/uikit@3.21.6/dist/css/uikit.min.css" />
  <style>
    .live-paragraph { font-size: 1.13rem; max-width: 40em; margin-left:auto; margin-right:auto;}

/* Simple 3-size system for text blocks */
.live-heading.h-sm { font-size: 2.2rem; line-height: 1.15; }
.live-heading.h-md { font-size: 3.2rem; line-height: 1.12; }
.live-heading.h-lg { font-size: 4.2rem; line-height: 1.08; }

.live-subtitle.sub-sm { font-size: 1.1rem; font-weight: 500; }
.live-subtitle.sub-md { font-size: 1.35rem; font-weight: 500; }
.live-subtitle.sub-lg { font-size: 1.7rem; font-weight: 500; }

.live-paragraph.p-sm { font-size: 1.0rem; }
.live-paragraph.p-md { font-size: 1.13rem; }
.live-paragraph.p-lg { font-size: 1.30rem; }

@media (max-width: 640px) {
  .live-heading.h-lg { font-size: 2.6rem; }
  .live-heading.h-md { font-size: 2.0rem; }
  .live-heading.h-sm { font-size: 1.6rem; }

  .live-subtitle.sub-lg { font-size: 1.2rem; }
  .live-subtitle.sub-md { font-size: 1.05rem; }
  .live-subtitle.sub-sm { font-size: 0.95rem; }

  .live-paragraph.p-lg { font-size: 1.05rem; }
  .live-paragraph.p-md { font-size: 0.98rem; }
  .live-paragraph.p-sm { font-size: 0.92rem; }
}

    .live-paragraph.uk-text-large { font-size: 1.45rem; }
    @media (max-width: 640px) {
      .live-paragraph { font-size: 1rem;}
      .live-paragraph.uk-text-large { font-size: 1.1rem;}
    }
    img, video { max-width: 100%; height: auto; display: block; }
    @media (max-width: 640px) {
      .live-heading, .live-subtitle, .live-paragraph {
        text-align: center !important;
        word-break: break-word;
        white-space: normal;
      }
    }
    .navbar-scroll {
      display:flex; flex-wrap:nowrap; gap:1rem; overflow-x:auto; white-space:nowrap; -webkit-overflow-scrolling:touch; padding:0.5rem 1rem; align-items:center; list-style:none; margin:0;
    }
    .navbar-scroll a { flex:0 0 auto; text-decoration:none; color:inherit; }
    .navbar-scroll a.uk-active { font-weight:bold; border-bottom:2px solid currentColor; }
  
.navbar-logo {
  height: 40px !important;
  width: auto !important;
  max-height: 40px !important;
  object-fit: contain;
  flex-shrink: 0 !important;
  flex-grow: 0 !important;
}
.navbar-scroll {
  display: flex;
  flex-wrap: nowrap;
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
  white-space: nowrap;
  gap: 1rem;
  padding: 0.5rem 1rem;
}
.navbar-scroll li {
  flex: 0 0 auto;
  list-style: none;
}

.visually-hidden {
  position: absolute !important;
  width: 1px; height: 1px;
  margin: -1px; padding: 0; border: 0;
  overflow: hidden; clip: rect(0 0 0 0); clip-path: inset(50%);
  white-space: nowrap;
}

  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0,0,0,0);
  border: 0;
}

:root {
  --navbar-link-color: #000000;
}

.navbar-scroll::-webkit-scrollbar {
  height: 6px;
}
.navbar-scroll::-webkit-scrollbar-thumb {
  background: var(--navbar-link-color);
  border-radius: 3px;
}
.navbar-scroll::-webkit-scrollbar-track {
  background: var(--gray, #eee);
}


.navbar-scroll {
  -ms-overflow-style: none;  /* IE & Edge */
  scrollbar-width: none;     /* Firefox */
}
.navbar-scroll::-webkit-scrollbar {
  display: none;             /* Chrome, Safari, Opera */
}

</style>
</head>
<body class="uk-background-muted" id="top">
<h1 id="site-title-h1" class="visually-hidden"></h1>
${navBarHtml}
${exportBlocks}
  ${buildFooterHtml()}
<script src="https://cdn.jsdelivr.net/npm/uikit@3.21.6/dist/js/uikit.min.js"><\/script>
<script src="https://cdn.jsdelivr.net/npm/uikit@3.21.6/dist/js/uikit-icons.min.js"><\/script>
</body>
</html>
`;

    let previewWindow = window.open("", "_blank");
    previewWindow.document.open();
    previewWindow.document.write(html);
    previewWindow.document.close();
});

        // Export as HTML+media ZIP
 exportHTMLBtn.addEventListener('click', async function() {
    const JSZip = window.JSZip;
    const zip = new JSZip();
    const exportMap = {};
    let promises = [];
    let fileIdx = 0;

    allSections.forEach((block, idx) => {
        if (block.fileData && block.fileName) {
            let ext = block.fileName.split('.').pop().toLowerCase();
            let newName = `mediafile${fileIdx + 1}.${ext}`;
            exportMap[block.fileName] = newName;
            promises.push(fetch(block.fileData).then(res => res.blob()).then(blob => {
                zip.file('media/' + newName, blob);
            }));
            fileIdx++;
        }
    });

// Include navbar logo in export (blob -> /media/logo.<ext>)
if (siteSettings.navbar.logoBlob && siteSettings.navbar.logoFileName) {
  const ext = siteSettings.navbar.logoFileName.split('.').pop().toLowerCase() || 'png';
  const newName = `logo.${ext}`;
  zip.file('media/' + newName, siteSettings.navbar.logoBlob);
  siteSettings.navbar.logoExport = 'media/' + newName;
}    

// Include favicon in export if uploaded
if (siteSettings.faviconBlob && siteSettings.faviconFileName) {
    let ext = siteSettings.faviconFileName.split('.').pop().toLowerCase() || 'ico';
    let newName = `favicon.${ext}`;
    zip.file('media/' + newName, siteSettings.faviconBlob);
    siteSettings.faviconExport = 'media/' + newName;
}

// Include social image in export if uploaded
if (siteSettings.socialBlob && siteSettings.socialFileName) {
    let ext = siteSettings.socialFileName.split('.').pop().toLowerCase() || 'png';
    let newName = `social.${ext}`;
    zip.file('media/' + newName, siteSettings.socialBlob);
    siteSettings.socialExport = 'media/' + newName;
}

    await Promise.all(promises);


let exportBlocks = allSections.map((block, idx) =>
    `<section id="section-${idx}" class="uk-section uk-section-primary" uk-height-viewport="offset-top: true" style="background:${block.bgColor};min-height:60vh;padding:0;margin:0;">
        ${getExportSectionHtml(block, exportMap)}
    </section>`
).join('\n');

    let navBarHtml = buildPreviewDynamicNavBarHtml();

let html = `
<!DOCTYPE html>
<html lang="${siteSettings.language}">
<head>
  <meta charset="UTF-8">
  <title>${siteSettings.title}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="${siteSettings.description}">
  <meta name="robots" content="${siteSettings.robots}">
  <meta name="author" content="${siteSettings.author}">
`;

// Add font injection OUTSIDE the string
if (siteSettings.fontName) {
  const fontUrl = `https://fonts.googleapis.com/css2?family=${siteSettings.fontName.replace(/ /g,'+')}&display=swap`;
  html += `<link href="${fontUrl}" rel="stylesheet">\n`;
  html += `<style>\n${generateFontCSS()}\n</style>\n`;
}

// Continue building string here
html += `
  ${siteSettings.faviconExport ? `<link rel="icon" href="${siteSettings.faviconExport}">\n  <link rel="shortcut icon" href="${siteSettings.faviconExport}">` : ''}
  ${siteSettings.socialExport ? `<meta property="og:image" content="${siteSettings.socialExport}">` : ''}
  ${siteSettings.headScript || ''}
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/uikit@3.21.6/dist/css/uikit.min.css" />
  <style>
    .live-paragraph { font-size: 1.13rem; max-width: 40em; margin-left:auto; margin-right:auto;}

/* Simple 3-size system for text blocks */
.live-heading.h-sm { font-size: 2.2rem; line-height: 1.15; }
.live-heading.h-md { font-size: 3.2rem; line-height: 1.12; }
.live-heading.h-lg { font-size: 4.2rem; line-height: 1.08; }

.live-subtitle.sub-sm { font-size: 1.1rem; font-weight: 500; }
.live-subtitle.sub-md { font-size: 1.35rem; font-weight: 500; }
.live-subtitle.sub-lg { font-size: 1.7rem; font-weight: 500; }

.live-paragraph.p-sm { font-size: 1.0rem; }
.live-paragraph.p-md { font-size: 1.13rem; }
.live-paragraph.p-lg { font-size: 1.30rem; }

@media (max-width: 640px) {
  .live-heading.h-lg { font-size: 2.6rem; }
  .live-heading.h-md { font-size: 2.0rem; }
  .live-heading.h-sm { font-size: 1.6rem; }

  .live-subtitle.sub-lg { font-size: 1.2rem; }
  .live-subtitle.sub-md { font-size: 1.05rem; }
  .live-subtitle.sub-sm { font-size: 0.95rem; }

  .live-paragraph.p-lg { font-size: 1.05rem; }
  .live-paragraph.p-md { font-size: 0.98rem; }
  .live-paragraph.p-sm { font-size: 0.92rem; }
}

    .live-paragraph.uk-text-large { font-size: 1.45rem; }
    @media (max-width: 640px) {
      .live-paragraph { font-size: 1rem;}
      .live-paragraph.uk-text-large { font-size: 1.1rem;}
    }
    /* Make exported images/videos responsive */
    img, video {
      max-width: 100%;
      height: auto;
      display: block;
    }

@media (max-width: 640px) {
  .live-heading, .live-subtitle, .live-paragraph {
    text-align: center !important;
    word-break: break-word;
    white-space: normal;
  }
}
    .navbar-scroll { display:flex; flex-wrap:nowrap; gap:1rem; overflow-x:auto; white-space:nowrap; -webkit-overflow-scrolling:touch; padding:0.5rem 1rem; align-items:center; list-style:none; margin:0; }
    .navbar-scroll a { flex:0 0 auto; text-decoration:none; color:inherit; }
    .navbar-scroll a.uk-active { font-weight:bold; border-bottom:2px solid currentColor; }
  
.navbar-logo {
  height: 40px !important;
  width: auto !important;
  max-height: 40px !important;
  object-fit: contain;
  flex-shrink: 0 !important;
  flex-grow: 0 !important;
}
.navbar-scroll {
  display: flex;
  flex-wrap: nowrap;
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
  white-space: nowrap;
  gap: 1rem;
  padding: 0.5rem 1rem;
}
.navbar-scroll li {
  flex: 0 0 auto;
  list-style: none;
}

.visually-hidden {
  position: absolute !important;
  width: 1px; height: 1px;
  margin: -1px; padding: 0; border: 0;
  overflow: hidden; clip: rect(0 0 0 0); clip-path: inset(50%);
  white-space: nowrap;
}

  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0,0,0,0);
  border: 0;
}


:root {
  --navbar-link-color: #000000;
}

.navbar-scroll::-webkit-scrollbar {
  height: 6px;
}
.navbar-scroll::-webkit-scrollbar-thumb {
  background: var(--navbar-link-color);
  border-radius: 3px;
}
.navbar-scroll::-webkit-scrollbar-track {
  background: var(--gray, #eee);
}


.navbar-scroll {
  -ms-overflow-style: none;  /* IE & Edge */
  scrollbar-width: none;     /* Firefox */
}
.navbar-scroll::-webkit-scrollbar {
  display: none;             /* Chrome, Safari, Opera */
}

</style>
</head>
<body class="uk-background-muted" id="top">
<h1 id="site-title-h1" class="visually-hidden">${siteSettings.title}</h1>
${navBarHtml}
${exportBlocks}
  ${buildFooterHtml()}
<script src="https://cdn.jsdelivr.net/npm/uikit@3.21.6/dist/js/uikit.min.js"><\/script>
<script src="https://cdn.jsdelivr.net/npm/uikit@3.21.6/dist/js/uikit-icons.min.js"><\/script>
</body>
</html>
`;

    zip.file('index.html', html);

    const blob = await zip.generateAsync({ type: "blob" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
let fileName = prompt("Enter a name for your exported ZIP file:", "homepage.zip");
if (!fileName) fileName = "homepage.zip"; // fallback
a.download = fileName.endsWith(".zip") ? fileName : fileName + ".zip";
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
});
        // UIKit tooltips
        UIkit.util.on(document, 'DOMContentLoaded', function() {
            UIkit.tooltip('[uk-tooltip]');
        });

    
function formatText(command) {
  document.execCommand(command, false, null);
}

function addLink() {
  const sel = window.getSelection();
  if (!sel.rangeCount || sel.toString().length === 0) {
    alert("Please select some text first.");
    return;
  }

  const url = prompt("Enter the link URL:", "https://");
  if (!url) return;

  const range = sel.getRangeAt(0);
  const a = document.createElement("a");
  a.href = url;
  a.target = "_blank"; // open in new tab
  a.classList.add("uk-link");
  a.textContent = sel.toString();

  range.deleteContents();
  range.insertNode(a);
}

function removeLink() {
  const sel = window.getSelection();
  if (!sel.rangeCount) return;

  const range = sel.getRangeAt(0);
  let container = range.commonAncestorContainer;
  if (container.nodeType === 3) { // text node
    container = container.parentNode;
  }

  if (container && container.tagName === 'A') {
    const textNode = document.createTextNode(container.textContent);
    container.parentNode.replaceChild(textNode, container);
  } else {
    alert("Please place the cursor inside a link to remove it.");
  }
}

function createYouTubeEmbed(url) {
  const match = url.match(/(?:youtu\.be\/|youtube\.com\/watch\?v=)([^&]+)/);
  if (match) {
    const videoId = match[1];
    return `
      <div style="display:flex; align-items:center; justify-content:center; width:100%; height:100dvh; background:#000;">
        <div style="position:relative; width:100%; max-width:100%; aspect-ratio:16/9; min-height:100dvh;">
          <iframe src="https://www.youtube.com/embed/${videoId}?rel=0&playsinline=1" 
                  style="position:absolute; top:0; left:0; width:100%; height:100%; border:0;" 
                  allow="autoplay; fullscreen; picture-in-picture" 
                  allowfullscreen 
                  loading="lazy"></iframe>
        </div>
      </div>`;
  }
  return "<p>Invalid YouTube URL</p>";
}

function createVimeoEmbed(url) {
  const match = url.match(/vimeo\.com\/(\d+)/);
  if (match) {
    const videoId = match[1];
    return `
      <div style="display:flex; align-items:center; justify-content:center; width:100%; height:100dvh; background:#000;">
        <div style="position:relative; width:100%; max-width:100%; aspect-ratio:16/9; min-height:100dvh;">
          <iframe src="https://player.vimeo.com/video/${videoId}?playsinline=1" 
                  style="position:absolute; top:0; left:0; width:100%; height:100%; border:0;" 
                  allow="autoplay; fullscreen; picture-in-picture" 
                  allowfullscreen 
                  loading="lazy"></iframe>
        </div>
      </div>`;
  }
  return "<p>Invalid Vimeo URL</p>";
}

function promptYouTube() {
  const url = prompt("Enter YouTube link:");
  if (url) {
    let block = { type: 'embed', code: createYouTubeEmbed(url) };
    allSections.push(block);
    renderAllSections();
    applyFontLink();
    applyCustomCSS();
    mediaModal.hide();
  }
}

function promptVimeo() {
  const url = prompt("Enter Vimeo link:");
  if (url) {
    let block = { type: 'embed', code: createVimeoEmbed(url) };
    allSections.push(block);
    renderAllSections();
    applyFontLink();
    applyCustomCSS();
    mediaModal.hide();
  }
}

</script>

<script>
  // Enhance media elements (images, iframes, videos)
  function enhanceMedia(root) {
    // Lazy-load images
    root.querySelectorAll('img').forEach(img => {
      if (!img.hasAttribute('loading')) {
        img.setAttribute('loading', 'lazy');
      }
    });

    // Lazy-load iframes
    root.querySelectorAll('iframe').forEach(frame => {
      if (!frame.hasAttribute('loading')) {
        frame.setAttribute('loading', 'lazy');
      }
    });

    // Optimize videos
    root.querySelectorAll('video').forEach(video => {
      if (!video.hasAttribute('preload')) {
        video.setAttribute('preload', 'none');
      }
      if (!video.hasAttribute('uk-video')) {
        video.setAttribute('uk-video', 'autoplay: inview');
      }
      video.setAttribute('muted', '');       // ensures autoplay works
      video.setAttribute('playsinline', ''); // important for mobile
    });
  }

  document.addEventListener("DOMContentLoaded", () => {
    // 1) Enhance all existing media when page loads
    enhanceMedia(document);

    // 2) Watch #page container for new sections added dynamically
    const target = document.querySelector("#page");
    if (target) {
      const observer = new MutationObserver(mutations => {
        mutations.forEach(mutation => {
          mutation.addedNodes.forEach(node => {
            if (node.nodeType === 1) {
              enhanceMedia(node); // auto-enhance new section
            }
          });
        });
      });
      observer.observe(target, { childList: true, subtree: true });
    }
  });
</script>

</body>
</html>